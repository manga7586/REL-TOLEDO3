<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>üì± Relat√≥rio de Atendimento Toledo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 80px;
            color: #333;
        }
        
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .app-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .app-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .offline-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #27ae60;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tab-container {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab.active {
            border-bottom-color: #3498db;
            background: white;
            color: #3498db;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: white;
            -webkit-appearance: none;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .form-control-readonly {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e0e0e0;
            cursor: not-allowed;
        }
        
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            flex: 1;
            min-width: 120px;
        }
        
        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            touch-action: manipulation;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }
        
        .fotos-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .foto-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            height: 120px;
            background: #f0f0f0;
        }
        
        .foto-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .foto-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            z-index: 2;
        }
        
        .foto-comment-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            z-index: 2;
        }
        
        .foto-comment-badge {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(39, 174, 96, 0.9);
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 3px;
            max-width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .foto-comment-text {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            font-size: 0.8rem;
            text-align: center;
            display: none;
            border-radius: 0 0 10px 10px;
            z-index: 1;
        }
        
        .foto-item:hover .foto-comment-text {
            display: block;
        }
        
        .relatorios-list {
            margin-top: 20px;
        }
        
        .relatorio-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            position: relative;
        }
        
        .relatorio-card h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .relatorio-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .status-pendente { background: #fef9e7; color: #f39c12; }
        .status-concluido { background: #e8f8f5; color: #27ae60; }
        .status-cancelado { background: #fdedec; color: #e74c3c; }
        
        .no-items {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }
        
        .no-items i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .counter {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .modal-photo {
            width: 100%;
            max-height: 60vh;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .actions-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        /* ESTILOS ESPEC√çFICOS DO RELAT√ìRIO DE ATENDIMENTO */
        .header-relatorio {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .titulo-relatorio {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .info-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .logo-container {
            flex: 1;
            min-width: 150px;
        }
        
        .logo-placeholder {
            width: 100%;
            height: 80px;
            background: #f0f0f0;
            border: 2px dashed #3498db;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logo-placeholder:hover {
            background: #e8f4fc;
            border-color: #2980b9;
        }
        
        .logo-placeholder i {
            font-size: 2rem;
            margin-bottom: 5px;
            color: #3498db;
        }
        
        .logo-img {
            width: 100%;
            height: 80px;
            object-fit: contain;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .info-center {
            flex: 2;
            text-align: center;
            min-width: 200px;
        }
        
        .info-right {
            flex: 1;
            min-width: 150px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .info-field {
            flex: 1;
            min-width: 120px;
        }
        
        .info-field label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
            display: block;
        }
        
        .info-field input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .info-field input.readonly {
            background: #f8f9fa;
            color: #666;
            cursor: not-allowed;
        }
        
        .logo-buttons {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .logo-buttons button {
            flex: 1;
            padding: 6px 10px;
            font-size: 0.8rem;
        }
        
        /* Bot√µes de a√ß√£o em linha */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-buttons button {
            flex: 1;
            padding: 10px 5px;
            font-size: 0.85rem;
        }
        
        /* Badge para relat√≥rio editado */
        .edited-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f39c12;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* Modal de coment√°rio de foto */
        .comment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .comment-modal-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
        }
        
        .comment-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
            resize: vertical;
            min-height: 80px;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .comment-preview {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .comment-preview img {
            max-width: 100px;
            max-height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        /* Estilos para hist√≥rico de edi√ß√µes */
        .historico-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }
        
        .historico-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .historico-item {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .historico-data {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .historico-descricao {
            font-size: 0.9rem;
            color: #333;
        }
        
        .campo-alterado {
            background: #e8f4fc;
            border: 1px solid #3498db;
            border-radius: 6px;
            padding: 8px;
            margin-top: 5px;
            font-size: 0.85rem;
        }
        
        .campo-alterado strong {
            color: #2c3e50;
        }
        
        /* √Årea para adicionar novas informa√ß√µes */
        .novas-informacoes {
            background: #f0f9f0;
            border: 2px dashed #27ae60;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .novas-informacoes-title {
            color: #27ae60;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .informacoes-originais {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .informacoes-originais strong {
            color: #2c3e50;
        }
        
        .info-label-readonly {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .info-label-readonly span {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
                padding-bottom: 70px;
            }
            
            .app-container {
                border-radius: 15px;
            }
            
            .fotos-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tab {
                padding: 12px 8px;
                font-size: 0.9rem;
            }
            
            .info-container {
                flex-direction: column;
            }
            
            .logo-container, .info-center, .info-right {
                width: 100%;
                margin-bottom: 15px;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            .action-buttons button {
                min-width: calc(50% - 5px);
            }
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideUp 0.3s ease;
            display: none;
            max-width: 90%;
            text-align: center;
        }
        
        @keyframes slideUp {
            from { bottom: 50px; opacity: 0; }
            to { bottom: 80px; opacity: 1; }
        }
        
        .photo-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .photo-options button {
            flex: 1;
            padding: 10px;
        }
        
        .camera-instruction {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .camera-instruction i {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .toggle-btn {
            background: none;
            border: none;
            color: #3498db;
            font-size: 0.8rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .toggle-btn:hover {
            background: #f0f0f0;
        }
        
        /* NOVOS ESTILOS PARA EDI√á√ÉO DIRETA */
        .btn-edit-direct {
            background: linear-gradient(135deg, #f39c12 0%, #d35400 100%);
            color: white;
        }
        
        .edicao-direta-badge {
            background: #e67e22;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .modo-edicao-direta {
            border: 3px solid #f39c12;
            border-radius: 15px;
            position: relative;
        }
        
        .modo-edicao-direta::before {
            content: "MODO EDI√á√ÉO DIRETA";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #f39c12;
            color: white;
            padding: 5px 15px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="app-header">
            <div class="offline-badge">
                <i class="fas fa-wifi-slash"></i> OFFLINE
            </div>
            <h1><i class="fas fa-file-alt"></i> Relat√≥rio de Atendimento</h1>
            <p>Sistema Toledo do Brasil</p>
        </div>
        
        <div class="tab-container">
            <div class="tab active" data-tab="novo">
                <i class="fas fa-plus-circle"></i> Novo Atendimento
            </div>
            <div class="tab" data-tab="relatorios">
                <i class="fas fa-list"></i> Meus Relat√≥rios
            </div>
            <div class="tab" data-tab="fotos">
                <i class="fas fa-images"></i> Fotos
            </div>
        </div>
        
        <!-- TAB NOVO/EDITAR RELAT√ìRIO -->
        <div id="novo" class="tab-content active">
            <!-- CABE√áALHO DO RELAT√ìRIO -->
            <div class="header-relatorio">
                <div class="titulo-relatorio">
                    RELAT√ìRIO DE ATENDIMENTO
                </div>
                
                <div class="info-container">
                    <!-- LOGO TOLEDO -->
                    <div class="logo-container">
                        <label>Toledo do Brasil SI</label>
                        <div id="logoToledoPlaceholder" class="logo-placeholder" onclick="app.selecionarLogoToledo()">
                            <i class="fas fa-camera"></i>
                            <span>Logo Toledo</span>
                            <small>Toque para adicionar</small>
                        </div>
                        <img id="logoToledoImg" class="logo-img" style="display: none;">
                        <div id="logoToledoButtons" class="logo-buttons" style="display: none;">
                            <button onclick="app.selecionarLogoToledo()" class="btn btn-secondary" style="padding: 5px; font-size: 0.8rem;">
                                <i class="fas fa-sync"></i> Trocar
                            </button>
                            <button onclick="app.removerLogoToledo()" class="btn btn-danger" style="padding: 5px; font-size: 0.8rem;">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </div>
                    </div>
                    
                    <!-- INFORMA√á√ïES CENTRAIS -->
                    <div class="info-center">
                        <div class="info-field">
                            <label>DATA</label>
                            <input type="date" id="dataAtendimento" class="form-control" value="">
                        </div>
                        <div style="margin-top: 10px;">
                            <label>NOME DA EMPRESA ATENDIDA</label>
                            <input type="text" id="empresaAtendida" class="form-control" placeholder="Digite o nome da empresa">
                        </div>
                    </div>
                    
                    <!-- LOGO EMPRESA ATENDIDA -->
                    <div class="logo-container">
                        <label>Empresa Atendida</label>
                        <div id="logoEmpresaPlaceholder" class="logo-placeholder" onclick="app.selecionarLogoEmpresa()">
                            <i class="fas fa-building"></i>
                            <span>Logo Empresa</span>
                            <small>Toque para adicionar</small>
                        </div>
                        <img id="logoEmpresaImg" class="logo-img" style="display: none;">
                        <div id="logoEmpresaButtons" class="logo-buttons" style="display: none;">
                            <button onclick="app.selecionarLogoEmpresa()" class="btn btn-secondary" style="padding: 5px; font-size: 0.8rem;">
                                <i class="fas fa-sync"></i> Trocar
                            </button>
                            <button onclick="app.removerLogoEmpresa()" class="btn btn-danger" style="padding: 5px; font-size: 0.8rem;">
                                <i class="fas fa-trash"></i> Remover
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="info-row">
                    <div class="info-field">
                        <label>N√öMERO DA O.S.</label>
                        <input type="text" id="numeroOS" class="form-control" placeholder="N√∫mero da Ordem de Servi√ßo">
                    </div>
                    <div class="info-field">
                        <label>REVIS√ÉO</label>
                        <input type="text" id="revisao" class="form-control" value="00">
                    </div>
                    <div class="info-field">
                        <label>N√öMERO</label>
                        <input type="text" id="numeroAtendimento" class="form-control" placeholder="N√∫mero do atendimento">
                    </div>
                </div>
            </div>
            
            <!-- INFORMA√á√ïES ORIGINAIS (mostradas apenas durante edi√ß√£o) -->
            <div id="informacoesOriginaisContainer" class="informacoes-originais" style="display: none;">
                <p><strong><i class="fas fa-history"></i> Informa√ß√µes Originais do Relat√≥rio</strong></p>
                <div id="informacoesOriginais"></div>
                <button type="button" class="toggle-btn" onclick="app.toggleInformacoesOriginais()">
                    <i class="fas fa-eye"></i> Mostrar/Esconder
                </button>
            </div>
            
            <!-- NOVAS INFORMA√á√ïES (s√≥ aparece durante edi√ß√£o) -->
            <div id="novasInformacoesContainer" class="novas-informacoes" style="display: none;">
                <div class="novas-informacoes-title">
                    <i class="fas fa-plus-circle"></i> Adicionar Novas Informa√ß√µes
                </div>
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                    Voc√™ est√° adicionando novas informa√ß√µes ao relat√≥rio existente.
                </p>
                
                <!-- NOVO T√çTULO (opcional) -->
                <div class="form-group">
                    <label for="novoTitulo"><i class="fas fa-heading"></i> Novo T√≠tulo (opcional)</label>
                    <input type="text" id="novoTitulo" class="form-control" placeholder="Deixe em branco para manter o t√≠tulo original">
                </div>
                
                <!-- NOVA DESCRI√á√ÉO (adicionar ao existente) -->
                <div class="form-group">
                    <label for="novaDescricao"><i class="fas fa-align-left"></i> Adicionar √† Descri√ß√£o</label>
                    <textarea id="novaDescricao" class="form-control" rows="3" placeholder="Adicione novas informa√ß√µes √† descri√ß√£o existente..."></textarea>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        Esta informa√ß√£o ser√° adicionada √† descri√ß√£o original.
                    </p>
                </div>
                
                <!-- NOVO STATUS -->
                <div class="form-group">
                    <label><i class="fas fa-check-circle"></i> Atualizar Status</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="novoStatus" value="pendente">
                            <i class="fas fa-clock"></i> Pendente
                        </label>
                        <label>
                            <input type="radio" name="novoStatus" value="concluido">
                            <i class="fas fa-check"></i> Conclu√≠do
                        </label>
                        <label>
                            <input type="radio" name="novoStatus" value="cancelado">
                            <i class="fas fa-times"></i> Cancelado
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- CONTE√öDO DO RELAT√ìRIO -->
            <div id="conteudoOriginal" style="display: block;">
                <div class="form-group">
                    <label for="titulo"><i class="fas fa-heading"></i> T√≠tulo do Relat√≥rio</label>
                    <input type="text" id="titulo" class="form-control" placeholder="Descreva o assunto do atendimento" required>
                </div>
                
                <div class="form-group">
                    <label for="local"><i class="fas fa-map-marker-alt"></i> Local do Atendimento</label>
                    <input type="text" id="local" class="form-control" placeholder="Endere√ßo ou local espec√≠fico" required>
                </div>
                
                <div class="form-group">
                    <label for="descricao"><i class="fas fa-align-left"></i> Descri√ß√£o Detalhada</label>
                    <textarea id="descricao" class="form-control" rows="4" placeholder="Descreva detalhadamente o que foi feito no atendimento..."></textarea>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> Tipo de Atendimento</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="tipo" value="manutencao" checked>
                            <i class="fas fa-tools"></i> Manuten√ß√£o
                        </label>
                        <label>
                            <input type="radio" name="tipo" value="instalacao">
                            <i class="fas fa-wrench"></i> Instala√ß√£o
                        </label>
                        <label>
                            <input type="radio" name="tipo" value="calibracao">
                            <i class="fas fa-balance-scale"></i> Calibra√ß√£o
                        </label>
                        <label>
                            <input type="radio" name="tipo" value="visita">
                            <i class="fas fa-user-check"></i> Visita T√©cnica
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Status do relat√≥rio -->
            <div id="statusGroup" class="form-group" style="display: none;">
                <label><i class="fas fa-check-circle"></i> Status do Relat√≥rio</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="status" value="pendente">
                        <i class="fas fa-clock"></i> Pendente
                    </label>
                    <label>
                        <input type="radio" name="status" value="concluido">
                        <i class="fas fa-check"></i> Conclu√≠do
                    </label>
                    <label>
                        <input type="radio" name="status" value="cancelado">
                            <i class="fas fa-times"></i> Cancelado
                    </label>
                </div>
            </div>
            
            <!-- ADICIONAR FOTOS -->
            <div class="form-group">
                <label><i class="fas fa-images"></i> Fotos do Atendimento <small style="color: #666;">(Toque no √≠cone üí¨ para comentar cada foto)</small></label>
                <div class="camera-instruction">
                    <i class="fas fa-camera"></i>
                    <h3>Adicionar Fotos do Servi√ßo</h3>
                    <p>Documente com fotos o antes, durante e depois do atendimento</p>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                        <i class="fas fa-comment"></i> Adicione coment√°rios para explicar cada foto
                    </p>
                </div>
                
                <div class="photo-options">
                    <button id="takePhotoBtn" class="btn btn-primary">
                        <i class="fas fa-camera"></i> Tirar Foto
                    </button>
                    <button id="choosePhotoBtn" class="btn btn-secondary">
                        <i class="fas fa-folder-open"></i> Escolher da Galeria
                    </button>
                </div>
                
                <!-- Inputs ocultos para fotos -->
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
                <input type="file" id="galleryInput" accept="image/*" multiple style="display: none;">
                <input type="file" id="logoToledoInput" accept="image/*" style="display: none;">
                <input type="file" id="logoEmpresaInput" accept="image/*" style="display: none;">
                
                <div id="fotosContainer" class="fotos-grid">
                    <div class="no-items">
                        <i class="fas fa-camera"></i>
                        <p>Nenhuma foto ainda</p>
                        <p style="font-size: 0.9rem; margin-top: 5px;">
                            Toque nos bot√µes acima para adicionar fotos
                        </p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 5px;">
                    <span id="fotosCount" class="counter">0 fotos</span>
                    <span id="fotosComentadasCount" style="margin-left: 10px; font-size: 0.9rem; color: #666;">
                        0 com coment√°rios
                    </span>
                </div>
            </div>
            
            <!-- HIST√ìRICO DE EDI√á√ïES (mostrado apenas durante edi√ß√£o) -->
            <div id="historicoContainer" class="historico-container" style="display: none;">
                <div class="historico-title">
                    <i class="fas fa-history"></i> Hist√≥rico de Edi√ß√µes
                </div>
                <div id="historicoEdicoes"></div>
            </div>
            
            <!-- Campo oculto para ID do relat√≥rio em edi√ß√£o -->
            <input type="hidden" id="relatorioId">
            <input type="hidden" id="modoEdicaoDireta" value="false">
            
            <!-- BOT√ïES DE A√á√ÉO -->
            <div id="botoesNovo" style="display: block;">
                <button id="salvarRelatorio" class="btn btn-primary">
                    <i class="fas fa-save"></i> SALVAR RELAT√ìRIO
                </button>
                
                <button id="gerarPDF" class="btn btn-success">
                    <i class="fas fa-file-pdf"></i> GERAR PDF
                </button>
                
                <button id="limparFormulario" class="btn btn-secondary">
                    <i class="fas fa-eraser"></i> LIMPAR FORMUL√ÅRIO
                </button>
            </div>
            
            <div id="botoesEditar" style="display: none;">
                <div class="action-buttons">
                    <button id="salvarEdicao" class="btn btn-success">
                        <i class="fas fa-plus-circle"></i> ADICIONAR INFORMA√á√ïES
                    </button>
                    
                    <button id="cancelarEdicao" class="btn btn-secondary">
                        <i class="fas fa-times"></i> CANCELAR
                    </button>
                    
                    <button id="gerarPDFEditar" class="btn btn-primary">
                        <i class="fas fa-file-pdf"></i> GERAR PDF ATUAL
                    </button>
                    
                    <button id="duplicarRelatorio" class="btn btn-info">
                        <i class="fas fa-copy"></i> DUPLICAR
                    </button>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 0.9rem;">
                    <p><strong><i class="fas fa-info-circle"></i> Adicionando Informa√ß√µes ao Relat√≥rio</strong></p>
                    <p style="margin-top: 5px; color: #666;">ID: <span id="relatorioIdTexto"></span></p>
                    <p style="color: #666;">Criado em: <span id="relatorioCriadoEm"></span></p>
                    <p style="color: #666;">√öltima edi√ß√£o: <span id="relatorioEditadoEm"></span></p>
                    <p style="color: #666; font-size: 0.85rem; margin-top: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> As informa√ß√µes originais ser√£o preservadas. Voc√™ est√° adicionando novas informa√ß√µes.
                    </p>
                </div>
            </div>
            
            <!-- BOT√ïES PARA EDI√á√ÉO DIRETA -->
            <div id="botoesEdicaoDireta" style="display: none;">
                <div class="action-buttons">
                    <button id="salvarEdicaoDireta" class="btn btn-warning">
                        <i class="fas fa-save"></i> SALVAR EDI√á√ÉO
                    </button>
                    
                    <button id="cancelarEdicaoDireta" class="btn btn-secondary">
                        <i class="fas fa-times"></i> CANCELAR EDI√á√ÉO
                    </button>
                    
                    <button id="gerarPDFEdicaoDireta" class="btn btn-primary">
                        <i class="fas fa-file-pdf"></i> GERAR PDF
                    </button>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #fef9e7; border-radius: 10px; font-size: 0.9rem; border: 2px solid #f39c12;">
                    <p><strong><i class="fas fa-edit"></i> Editando Relat√≥rio Existente</strong></p>
                    <p style="margin-top: 5px; color: #666;">ID: <span id="relatorioIdTextoDireta"></span></p>
                    <p style="color: #666;">Criado em: <span id="relatorioCriadoEmDireta"></span></p>
                    <p style="color: #666;">√öltima edi√ß√£o: <span id="relatorioEditadoEmDireta"></span></p>
                    <p style="color: #666; font-size: 0.85rem; margin-top: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> Voc√™ est√° editando diretamente este relat√≥rio. As altera√ß√µes sobrescrever√£o os dados anteriores.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- TAB MEUS RELAT√ìRIOS -->
        <div id="relatorios" class="tab-content">
            <div class="relatorios-list" id="listaRelatorios">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando seus relat√≥rios...</p>
                </div>
            </div>
        </div>
        
        <!-- TAB FOTOS -->
        <div id="fotos" class="tab-content">
            <div id="todasFotos" class="fotos-grid">
                <div class="no-items">
                    <i class="fas fa-images"></i>
                    <p>Nenhuma foto salva</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL PARA VISUALIZAR FOTO -->
    <div id="fotoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Visualizar Foto</h3>
                <button class="modal-close">&times;</button>
            </div>
            <img id="modalFoto" class="modal-photo" src="" alt="">
            <div id="modalComment" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                <p><strong>Coment√°rio:</strong> <span id="modalCommentText">Nenhum coment√°rio</span></p>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button id="downloadFotoBtn" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-download"></i> Baixar Foto
                </button>
                <button id="editarComentarioBtn" class="btn btn-warning" style="flex: 1;">
                    <i class="fas fa-comment"></i> Editar Coment√°rio
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL PARA COMENTAR FOTO -->
    <div id="commentModal" class="comment-modal" style="display: none;">
        <div class="comment-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-comment"></i> Comentar Foto</h3>
                <button class="modal-close" onclick="app.fecharCommentModal()">&times;</button>
            </div>
            
            <div id="commentPhotoPreview" class="comment-preview">
                <img id="commentPhotoImg" src="" alt="Foto">
                <p id="commentPhotoInfo">Foto selecionada</p>
            </div>
            
            <label for="commentInput"><i class="fas fa-edit"></i> Digite seu coment√°rio:</label>
            <textarea id="commentInput" class="comment-input" placeholder="Descreva esta foto... Ex: 'Vazamento na v√°lvula principal', 'Antes da manuten√ß√£o', 'Ap√≥s reparo'"></textarea>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button id="salvarCommentBtn" class="btn btn-success" style="flex: 1;">
                    <i class="fas fa-save"></i> Salvar Coment√°rio
                </button>
                <button id="cancelarCommentBtn" class="btn btn-secondary" style="flex: 1;" onclick="app.fecharCommentModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>
    
    <!-- TOAST MENSAGEM -->
    <div id="toast" class="toast"></div>
    
    <!-- BARRA DE A√á√ïES -->
    <div class="actions-bar">
        <button id="exportarBtn" class="btn btn-secondary" style="flex: 1;">
            <i class="fas fa-download"></i> Exportar
        </button>
        <button id="importarBtn" class="btn btn-secondary" style="flex: 1;">
            <i class="fas fa-upload"></i> Importar
        </button>
        <button id="limparBtn" class="btn btn-danger" style="flex: 1;">
            <i class="fas fa-trash"></i> Limpar Tudo
        </button>
    </div>
    
    <!-- INPUT OCULTO PARA IMPORTAR -->
    <input type="file" id="importarInput" accept=".json" style="display: none;">
    
    <script>
        // Sistema de Relat√≥rios de Atendimento Toledo
        class RelatorioToledoApp {
            constructor() {
                this.fotos = [];
                this.relatorios = [];
                this.logoToledo = null;
                this.logoEmpresa = null;
                this.currentFotoIndex = null;
                this.editandoRelatorioId = null;
                this.modoEdicao = false;
                this.modoEdicaoDireta = false;
                this.editandoComentarioIndex = null;
                this.relatorioOriginal = null;
                this.mostrarInformacoesOriginais = true;
                
                this.init();
            }
            
            init() {
                this.initElements();
                this.initEventListeners();
                this.initTabs();
                this.loadRelatorios();
                this.setDataAtual();
                
                this.showToast('üì± Sistema Toledo de Relat√≥rios pronto!', 'success');
            }
            
            initElements() {
                // Elementos do formul√°rio
                this.tituloInput = document.getElementById('titulo');
                this.localInput = document.getElementById('local');
                this.descricaoInput = document.getElementById('descricao');
                this.dataAtendimento = document.getElementById('dataAtendimento');
                this.empresaAtendida = document.getElementById('empresaAtendida');
                this.numeroOS = document.getElementById('numeroOS');
                this.revisao = document.getElementById('revisao');
                this.numeroAtendimento = document.getElementById('numeroAtendimento');
                this.relatorioIdInput = document.getElementById('relatorioId');
                this.modoEdicaoDiretaInput = document.getElementById('modoEdicaoDireta');
                
                // Novos campos para edi√ß√£o
                this.novoTituloInput = document.getElementById('novoTitulo');
                this.novaDescricaoInput = document.getElementById('novaDescricao');
                
                // Containers
                this.informacoesOriginaisContainer = document.getElementById('informacoesOriginaisContainer');
                this.informacoesOriginaisDiv = document.getElementById('informacoesOriginais');
                this.novasInformacoesContainer = document.getElementById('novasInformacoesContainer');
                this.conteudoOriginal = document.getElementById('conteudoOriginal');
                this.historicoContainer = document.getElementById('historicoContainer');
                this.historicoEdicoes = document.getElementById('historicoEdicoes');
                
                // Elementos de logo
                this.logoToledoPlaceholder = document.getElementById('logoToledoPlaceholder');
                this.logoToledoImg = document.getElementById('logoToledoImg');
                this.logoToledoButtons = document.getElementById('logoToledoButtons');
                this.logoEmpresaPlaceholder = document.getElementById('logoEmpresaPlaceholder');
                this.logoEmpresaImg = document.getElementById('logoEmpresaImg');
                this.logoEmpresaButtons = document.getElementById('logoEmpresaButtons');
                this.logoToledoInput = document.getElementById('logoToledoInput');
                this.logoEmpresaInput = document.getElementById('logoEmpresaInput');
                
                // Bot√µes de foto
                this.takePhotoBtn = document.getElementById('takePhotoBtn');
                this.choosePhotoBtn = document.getElementById('choosePhotoBtn');
                this.cameraInput = document.getElementById('cameraInput');
                this.galleryInput = document.getElementById('galleryInput');
                
                // Bot√µes principais
                this.salvarRelatorioBtn = document.getElementById('salvarRelatorio');
                this.gerarPDFBtn = document.getElementById('gerarPDF');
                this.limparFormularioBtn = document.getElementById('limparFormulario');
                this.salvarEdicaoBtn = document.getElementById('salvarEdicao');
                this.cancelarEdicaoBtn = document.getElementById('cancelarEdicao');
                this.gerarPDFEditarBtn = document.getElementById('gerarPDFEditar');
                this.duplicarRelatorioBtn = document.getElementById('duplicarRelatorio');
                this.limparBtn = document.getElementById('limparBtn');
                this.exportarBtn = document.getElementById('exportarBtn');
                this.importarBtn = document.getElementById('importarBtn');
                
                // Bot√µes para edi√ß√£o direta
                this.salvarEdicaoDiretaBtn = document.getElementById('salvarEdicaoDireta');
                this.cancelarEdicaoDiretaBtn = document.getElementById('cancelarEdicaoDireta');
                this.gerarPDFEdicaoDiretaBtn = document.getElementById('gerarPDFEdicaoDireta');
                
                // Containers
                this.fotosContainer = document.getElementById('fotosContainer');
                this.fotosCount = document.getElementById('fotosCount');
                this.fotosComentadasCount = document.getElementById('fotosComentadasCount');
                this.listaRelatorios = document.getElementById('listaRelatorios');
                this.todasFotos = document.getElementById('todasFotos');
                
                // Modal de foto
                this.fotoModal = document.getElementById('fotoModal');
                this.modalFoto = document.getElementById('modalFoto');
                this.modalClose = document.querySelector('.modal-close');
                this.downloadFotoBtn = document.getElementById('downloadFotoBtn');
                this.editarComentarioBtn = document.getElementById('editarComentarioBtn');
                this.modalCommentText = document.getElementById('modalCommentText');
                
                // Modal de coment√°rio
                this.commentModal = document.getElementById('commentModal');
                this.commentInput = document.getElementById('commentInput');
                this.commentPhotoImg = document.getElementById('commentPhotoImg');
                this.commentPhotoInfo = document.getElementById('commentPhotoInfo');
                this.salvarCommentBtn = document.getElementById('salvarCommentBtn');
                this.cancelarCommentBtn = document.getElementById('cancelarCommentBtn');
                
                // Toast
                this.toast = document.getElementById('toast');
                
                // Status group
                this.statusGroup = document.getElementById('statusGroup');
                
                // Bot√µes de modo
                this.botoesNovo = document.getElementById('botoesNovo');
                this.botoesEditar = document.getElementById('botoesEditar');
                this.botoesEdicaoDireta = document.getElementById('botoesEdicaoDireta');
                this.relatorioIdTexto = document.getElementById('relatorioIdTexto');
                this.relatorioCriadoEm = document.getElementById('relatorioCriadoEm');
                this.relatorioEditadoEm = document.getElementById('relatorioEditadoEm');
                this.relatorioIdTextoDireta = document.getElementById('relatorioIdTextoDireta');
                this.relatorioCriadoEmDireta = document.getElementById('relatorioCriadoEmDireta');
                this.relatorioEditadoEmDireta = document.getElementById('relatorioEditadoEmDireta');
                
                // Importar
                this.importarInput = document.getElementById('importarInput');
            }
            
            initEventListeners() {
                // Bot√µes de foto
                this.takePhotoBtn.addEventListener('click', () => this.cameraInput.click());
                this.choosePhotoBtn.addEventListener('click', () => this.galleryInput.click());
                
                // Inputs de arquivo
                this.cameraInput.addEventListener('change', (e) => this.handlePhotoInput(e, 'camera'));
                this.galleryInput.addEventListener('change', (e) => this.handlePhotoInput(e, 'gallery'));
                this.logoToledoInput.addEventListener('change', (e) => this.handleLogoInput(e, 'toledo'));
                this.logoEmpresaInput.addEventListener('change', (e) => this.handleLogoInput(e, 'empresa'));
                
                // Salvar e PDF
                this.salvarRelatorioBtn.addEventListener('click', () => this.salvarRelatorio());
                this.gerarPDFBtn.addEventListener('click', () => this.gerarPDFDireto());
                this.limparFormularioBtn.addEventListener('click', () => this.limparFormulario());
                this.salvarEdicaoBtn.addEventListener('click', () => this.salvarEdicao());
                this.cancelarEdicaoBtn.addEventListener('click', () => this.cancelarEdicao());
                this.gerarPDFEditarBtn.addEventListener('click', () => this.gerarPDFDireto());
                this.duplicarRelatorioBtn.addEventListener('click', () => this.duplicarRelatorio());
                
                // Bot√µes de edi√ß√£o direta
                this.salvarEdicaoDiretaBtn.addEventListener('click', () => this.salvarEdicaoDireta());
                this.cancelarEdicaoDiretaBtn.addEventListener('click', () => this.cancelarEdicaoDireta());
                this.gerarPDFEdicaoDiretaBtn.addEventListener('click', () => this.gerarPDFDireto());
                
                // Limpar tudo
                this.limparBtn.addEventListener('click', () => this.limparTudo());
                
                // Exportar/Importar
                this.exportarBtn.addEventListener('click', () => this.exportarDados());
                this.importarBtn.addEventListener('click', () => this.importarInput.click());
                this.importarInput.addEventListener('change', (e) => this.importarDados(e));
                
                // Modal de foto
                this.modalClose.addEventListener('click', () => this.fotoModal.style.display = 'none');
                this.downloadFotoBtn.addEventListener('click', () => this.downloadFoto());
                this.editarComentarioBtn.addEventListener('click', () => this.editarComentario());
                
                // Modal de coment√°rio
                this.salvarCommentBtn.addEventListener('click', () => this.salvarComentario());
                
                // Fechar modais ao clicar fora
                this.fotoModal.addEventListener('click', (e) => {
                    if (e.target === this.fotoModal) {
                        this.fotoModal.style.display = 'none';
                    }
                });
                
                this.commentModal.addEventListener('click', (e) => {
                    if (e.target === this.commentModal) {
                        this.fecharCommentModal();
                    }
                });
            }
            
            initTabs() {
                const tabs = document.querySelectorAll('.tab');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.getAttribute('data-tab');
                        
                        tabs.forEach(t => t.classList.remove('active'));
                        tabContents.forEach(tc => tc.classList.remove('active'));
                        
                        tab.classList.add('active');
                        document.getElementById(tabId).classList.add('active');
                        
                        if (tabId === 'relatorios') {
                            this.carregarListaRelatorios();
                        } else if (tabId === 'fotos') {
                            this.carregarTodasFotos();
                        } else if (tabId === 'novo') {
                            // Se estava editando e mudou de aba, cancela edi√ß√£o
                            if (this.modoEdicao || this.modoEdicaoDireta) {
                                this.cancelarEdicaoDireta();
                            }
                        }
                    });
                });
            }
            
            setDataAtual() {
                const hoje = new Date().toISOString().split('T')[0];
                this.dataAtendimento.value = hoje;
            }
            
            selecionarLogoToledo() {
                this.logoToledoInput.click();
            }
            
            selecionarLogoEmpresa() {
                this.logoEmpresaInput.click();
            }
            
            handleLogoInput(event, tipo) {
                const file = event.target.files[0];
                if (!file || !file.type.startsWith('image/')) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    this.redimensionarImagem(e.target.result, 300, 150, (fotoData) => {
                        if (tipo === 'toledo') {
                            this.logoToledo = fotoData;
                            this.logoToledoPlaceholder.style.display = 'none';
                            this.logoToledoImg.src = fotoData;
                            this.logoToledoImg.style.display = 'block';
                            this.logoToledoButtons.style.display = 'flex';
                        } else {
                            this.logoEmpresa = fotoData;
                            this.logoEmpresaPlaceholder.style.display = 'none';
                            this.logoEmpresaImg.src = fotoData;
                            this.logoEmpresaImg.style.display = 'block';
                            this.logoEmpresaButtons.style.display = 'flex';
                        }
                        this.showToast('‚úÖ Logo adicionado!', 'success');
                    });
                };
                
                reader.readAsDataURL(file);
                event.target.value = '';
            }
            
            removerLogoToledo() {
                this.logoToledo = null;
                this.logoToledoPlaceholder.style.display = 'flex';
                this.logoToledoImg.style.display = 'none';
                this.logoToledoButtons.style.display = 'none';
                this.showToast('üóëÔ∏è Logo Toledo removido', 'info');
            }
            
            removerLogoEmpresa() {
                this.logoEmpresa = null;
                this.logoEmpresaPlaceholder.style.display = 'flex';
                this.logoEmpresaImg.style.display = 'none';
                this.logoEmpresaButtons.style.display = 'none';
                this.showToast('üóëÔ∏è Logo empresa removido', 'info');
            }
            
            handlePhotoInput(event, source) {
                const files = event.target.files;
                if (!files || files.length === 0) return;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (file.type.startsWith('image/')) {
                        this.processarFoto(file, source);
                    }
                }
                
                event.target.value = '';
            }
            
            processarFoto(file, source) {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    this.redimensionarImagem(e.target.result, 1024, 1024, (fotoData) => {
                        this.adicionarFoto(fotoData, file.name || `${source}_${Date.now()}.jpg`);
                    });
                };
                
                reader.onerror = () => {
                    this.showToast('‚ùå Erro ao carregar imagem', 'error');
                };
                
                reader.readAsDataURL(file);
            }
            
            redimensionarImagem(dataUrl, maxWidth, maxHeight, callback) {
                const img = new Image();
                img.src = dataUrl;
                
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height && width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    } else if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    callback(canvas.toDataURL('image/jpeg', 0.8));
                };
                
                img.onerror = () => {
                    callback(dataUrl);
                };
            }
            
            adicionarFoto(fotoData, fileName) {
                const foto = {
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    data: fotoData,
                    timestamp: new Date().toLocaleString('pt-BR'),
                    dataObj: new Date().toISOString(),
                    fileName: fileName,
                    comentario: ''  // Inicializa sem coment√°rio
                };
                
                this.fotos.push(foto);
                this.atualizarGaleria();
                this.atualizarContadorFotos();
                
                this.showToast('‚úÖ Foto adicionada!', 'success');
                
                // Perguntar se quer adicionar coment√°rio
                setTimeout(() => {
                    if (confirm('Deseja adicionar um coment√°rio a esta foto?')) {
                        this.editarComentarioFoto(this.fotos.length - 1);
                    }
                }, 300);
            }
            
            atualizarGaleria() {
                if (this.fotos.length === 0) {
                    this.fotosContainer.innerHTML = `
                        <div class="no-items">
                            <i class="fas fa-camera"></i>
                            <p>Nenhuma foto ainda</p>
                            <p style="font-size: 0.9rem; margin-top: 5px;">
                                Toque nos bot√µes acima para adicionar fotos
                            </p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                this.fotos.forEach((foto, index) => {
                    const temComentario = foto.comentario && foto.comentario.trim() !== '';
                    const comentarioPreview = temComentario ? 
                        (foto.comentario.length > 20 ? foto.comentario.substring(0, 20) + '...' : foto.comentario) : 
                        '';
                    
                    html += `
                        <div class="foto-item">
                            <img src="${foto.data}" alt="Foto ${index + 1}" 
                                 onclick="app.verFoto(${index})">
                            <button class="foto-remove" onclick="app.removerFoto(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="foto-comment-btn" onclick="app.editarComentarioFoto(${index})">
                                <i class="fas fa-comment"></i>
                            </button>
                            ${temComentario ? `
                                <div class="foto-comment-badge">
                                    <i class="fas fa-comment"></i>
                                </div>
                            ` : ''}
                            ${temComentario ? `
                                <div class="foto-comment-text">
                                    ${comentarioPreview}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                this.fotosContainer.innerHTML = html;
            }
            
            atualizarContadorFotos() {
                this.fotosCount.textContent = `${this.fotos.length} foto${this.fotos.length !== 1 ? 's' : ''}`;
                
                // Contar fotos com coment√°rios
                const fotosComComentarios = this.fotos.filter(foto => 
                    foto.comentario && foto.comentario.trim() !== ''
                ).length;
                
                this.fotosComentadasCount.textContent = `${fotosComComentarios} com coment√°rio${fotosComComentarios !== 1 ? 's' : ''}`;
            }
            
            verFoto(index) {
                const foto = this.fotos[index];
                this.modalFoto.src = foto.data;
                this.currentFotoIndex = index;
                
                // Mostrar coment√°rio no modal
                if (foto.comentario && foto.comentario.trim() !== '') {
                    this.modalCommentText.textContent = foto.comentario;
                    document.getElementById('modalComment').style.display = 'block';
                } else {
                    this.modalCommentText.textContent = 'Nenhum coment√°rio';
                    document.getElementById('modalComment').style.display = 'block';
                }
                
                this.fotoModal.style.display = 'block';
            }
            
            editarComentario() {
                if (this.currentFotoIndex !== null) {
                    this.editarComentarioFoto(this.currentFotoIndex);
                }
            }
            
            editarComentarioFoto(index) {
                const foto = this.fotos[index];
                this.editandoComentarioIndex = index;
                
                // Preencher modal de coment√°rio
                this.commentPhotoImg.src = foto.data;
                this.commentPhotoInfo.textContent = `Foto ${index + 1} - ${foto.fileName || 'Sem nome'}`;
                this.commentInput.value = foto.comentario || '';
                
                // Mostrar modal
                this.commentModal.style.display = 'flex';
                this.commentInput.focus();
                
                // Se a foto estiver no modal de visualiza√ß√£o, fechar
                this.fotoModal.style.display = 'none';
            }
            
            salvarComentario() {
                if (this.editandoComentarioIndex === null) return;
                
                const comentario = this.commentInput.value.trim();
                this.fotos[this.editandoComentarioIndex].comentario = comentario;
                
                // Atualizar galeria
                this.atualizarGaleria();
                this.atualizarContadorFotos();
                
                // Fechar modal
                this.fecharCommentModal();
                
                // Mostrar mensagem
                if (comentario) {
                    this.showToast('‚úÖ Coment√°rio adicionado √† foto!', 'success');
                } else {
                    this.showToast('üóëÔ∏è Coment√°rio removido', 'info');
                }
            }
            
            fecharCommentModal() {
                this.commentModal.style.display = 'none';
                this.editandoComentarioIndex = null;
                this.commentInput.value = '';
            }
            
            removerFoto(index) {
                if (confirm('Remover esta foto?')) {
                    this.fotos.splice(index, 1);
                    this.atualizarGaleria();
                    this.atualizarContadorFotos();
                    this.showToast('üóëÔ∏è Foto removida', 'info');
                }
            }
            
            downloadFoto() {
                if (this.currentFotoIndex !== null) {
                    const foto = this.fotos[this.currentFotoIndex];
                    const link = document.createElement('a');
                    link.href = foto.data;
                    link.download = foto.fileName || `foto_${foto.id}.jpg`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    this.showToast('üì• Foto baixada!', 'success');
                }
            }
            
            salvarRelatorio() {
                // Validar dados
                if (!this.empresaAtendida.value.trim()) {
                    this.showToast('‚ùå Digite o nome da empresa atendida', 'error');
                    this.empresaAtendida.focus();
                    return;
                }
                
                if (!this.tituloInput.value.trim()) {
                    this.showToast('‚ùå Digite um t√≠tulo para o relat√≥rio', 'error');
                    this.tituloInput.focus();
                    return;
                }
                
                if (!this.localInput.value.trim()) {
                    this.showToast('‚ùå Informe o local do atendimento', 'error');
                    this.localInput.focus();
                    return;
                }
                
                try {
                    // Criar objeto do relat√≥rio
                    const relatorio = {
                        id: 'rel_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        titulo: this.tituloInput.value,
                        local: this.localInput.value,
                        descricao: this.descricaoInput.value,
                        tipo: document.querySelector('input[name="tipo"]:checked').value,
                        data: this.dataAtendimento.value,
                        dataFormatada: new Date(this.dataAtendimento.value).toLocaleDateString('pt-BR'),
                        empresaAtendida: this.empresaAtendida.value,
                        numeroOS: this.numeroOS.value,
                        revisao: this.revisao.value,
                        numeroAtendimento: this.numeroAtendimento.value,
                        logoToledo: this.logoToledo,
                        logoEmpresa: this.logoEmpresa,
                        fotos: [...this.fotos],
                        status: 'pendente',
                        criadoEm: new Date().toISOString(),
                        criadoEmFormatado: new Date().toLocaleString('pt-BR'),
                        editadoEm: new Date().toISOString(),
                        editadoEmFormatado: new Date().toLocaleString('pt-BR'),
                        editado: false,
                        historico: [],
                        descricaoOriginal: this.descricaoInput.value,
                        tituloOriginal: this.tituloInput.value,
                        statusOriginal: 'pendente'
                    };
                    
                    // Salvar no localStorage
                    this.salvarNoStorage(relatorio);
                    
                    // Adicionar √† lista
                    this.relatorios.unshift(relatorio);
                    
                    // Limpar formul√°rio (mas manter logos)
                    this.limparFormulario(true);
                    
                    // Mostrar mensagem de sucesso
                    this.showToast('‚úÖ Relat√≥rio de atendimento salvo!', 'success');
                    
                    // Perguntar se quer gerar PDF
                    setTimeout(() => {
                        if (confirm('Deseja gerar um PDF deste relat√≥rio?')) {
                            this.gerarPDF(relatorio);
                        }
                    }, 500);
                    
                    // Mudar para a aba de relat√≥rios
                    setTimeout(() => {
                        document.querySelector('[data-tab="relatorios"]').click();
                    }, 1000);
                    
                } catch (error) {
                    console.error('Erro ao salvar relat√≥rio:', error);
                    this.showToast('‚ùå Erro ao salvar relat√≥rio', 'error');
                }
            }
            
            salvarNoStorage(relatorio) {
                let relatoriosStorage = JSON.parse(localStorage.getItem('relatorios_toledo') || '[]');
                relatoriosStorage.unshift(relatorio);
                
                if (relatoriosStorage.length > 100) {
                    relatoriosStorage = relatoriosStorage.slice(0, 100);
                }
                
                localStorage.setItem('relatorios_toledo', JSON.stringify(relatoriosStorage));
            }
            
            atualizarNoStorage(relatorioAtualizado) {
                let relatoriosStorage = JSON.parse(localStorage.getItem('relatorios_toledo') || '[]');
                
                // Encontrar o √≠ndice do relat√≥rio a ser atualizado
                const index = relatoriosStorage.findIndex(r => r.id === relatorioAtualizado.id);
                
                if (index !== -1) {
                    // Atualizar o relat√≥rio
                    relatoriosStorage[index] = relatorioAtualizado;
                    localStorage.setItem('relatorios_toledo', JSON.stringify(relatoriosStorage));
                    return true;
                }
                
                return false;
            }
            
            loadRelatorios() {
                try {
                    const relatoriosStorage = JSON.parse(localStorage.getItem('relatorios_toledo') || '[]');
                    this.relatorios = relatoriosStorage;
                    
                    if (document.querySelector('[data-tab="relatorios"]').classList.contains('active')) {
                        this.carregarListaRelatorios();
                    }
                    
                } catch (error) {
                    console.error('Erro ao carregar relat√≥rios:', error);
                    this.relatorios = [];
                }
            }
            
            carregarListaRelatorios() {
                if (this.relatorios.length === 0) {
                    this.listaRelatorios.innerHTML = `
                        <div class="no-items">
                            <i class="fas fa-clipboard-list"></i>
                            <p>Nenhum relat√≥rio salvo</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">
                                Crie seu primeiro relat√≥rio na aba "Novo Atendimento"
                            </p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                this.relatorios.forEach(relatorio => {
                    const tipoIcon = {
                        'manutencao': 'fas fa-tools',
                        'instalacao': 'fas fa-wrench',
                        'calibracao': 'fas fa-balance-scale',
                        'visita': 'fas fa-user-check'
                    }[relatorio.tipo] || 'fas fa-file';
                    
                    const statusClass = {
                        'pendente': 'status-pendente',
                        'concluido': 'status-concluido',
                        'cancelado': 'status-cancelado'
                    }[relatorio.status] || 'status-pendente';
                    
                    const statusText = {
                        'pendente': 'Pendente',
                        'concluido': 'Conclu√≠do',
                        'cancelado': 'Cancelado'
                    }[relatorio.status] || 'Pendente';
                    
                    const tipoTexto = {
                        'manutencao': 'Manuten√ß√£o',
                        'instalacao': 'Instala√ß√£o',
                        'calibracao': 'Calibra√ß√£o',
                        'visita': 'Visita T√©cnica'
                    }[relatorio.tipo] || relatorio.tipo;
                    
                    const editadoBadge = relatorio.editado ? '<div class="edited-badge">Editado</div>' : '';
                    
                    // Contar fotos com coment√°rios
                    const fotosComComentarios = relatorio.fotos ? 
                        relatorio.fotos.filter(f => f.comentario && f.comentario.trim() !== '').length : 0;
                    const comentariosBadge = fotosComComentarios > 0 ? 
                        `<span style="background: #27ae60; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; margin-left: 5px;">
                            <i class="fas fa-comment"></i> ${fotosComComentarios}
                        </span>` : '';
                    
                    // Verificar se tem hist√≥rico
                    const temHistorico = relatorio.historico && relatorio.historico.length > 0;
                    const historicoBadge = temHistorico ? 
                        `<span style="background: #f39c12; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7rem; margin-left: 5px;">
                            <i class="fas fa-history"></i> ${relatorio.historico.length}
                        </span>` : '';
                    
                    html += `
                        <div class="relatorio-card">
                            ${editadoBadge}
                            <h3>${relatorio.empresaAtendida}</h3>
                            <p style="color: #666; margin-bottom: 5px;">
                                <i class="fas fa-briefcase"></i> ${relatorio.titulo}
                            </p>
                            <p style="color: #666; font-size: 0.9rem;">
                                <i class="${tipoIcon}"></i> ${tipoTexto} ‚Ä¢ 
                                ${relatorio.fotos ? relatorio.fotos.length : 0} fotos ${comentariosBadge} ${historicoBadge} ‚Ä¢
                                OS: ${relatorio.numeroOS || 'N/A'}
                            </p>
                            <div class="relatorio-meta">
                                <span>${relatorio.dataFormatada}</span>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="app.verRelatorioDetalhes('${relatorio.id}')" 
                                        class="btn btn-primary" style="padding: 8px 12px; font-size: 0.85rem; flex: 1;">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                                <button onclick="app.editarRelatorioDireto('${relatorio.id}')" 
                                        class="btn btn-warning" style="padding: 8px 12px; font-size: 0.85rem; flex: 1;">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button onclick="app.editarRelatorio('${relatorio.id}')" 
                                        class="btn btn-info" style="padding: 8px 12px; font-size: 0.85rem; flex: 1;">
                                    <i class="fas fa-plus"></i> Adicionar
                                </button>
                                <button onclick="app.exportarRelatorioPDF('${relatorio.id}')" 
                                        class="btn btn-success" style="padding: 8px 12px; font-size: 0.85rem; flex: 1;">
                                    <i class="fas fa-file-pdf"></i> PDF
                                </button>
                                <button onclick="app.excluirRelatorio('${relatorio.id}')" 
                                        class="btn btn-danger" style="padding: 8px 12px; font-size: 0.85rem; flex: 1;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                this.listaRelatorios.innerHTML = html;
            }
            
            verRelatorioDetalhes(relatorioId) {
                const relatorio = this.relatorios.find(r => r.id === relatorioId);
                if (!relatorio) return;
                
                let fotosHTML = '';
                if (relatorio.fotos && relatorio.fotos.length > 0) {
                    fotosHTML = `
                        <h4><i class="fas fa-images"></i> Fotos (${relatorio.fotos.length})</h4>
                        <div class="fotos-grid" style="margin-top: 10px;">
                            ${relatorio.fotos.map((foto, index) => `
                                <div class="foto-item" onclick="app.verFotoDetalhes('${relatorio.id}', ${index})">
                                    <img src="${foto.data}" alt="Foto ${index + 1}">
                                    ${foto.comentario && foto.comentario.trim() !== '' ? `
                                        <div class="foto-comment-badge">
                                            <i class="fas fa-comment"></i>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                let logosHTML = '';
                if (relatorio.logoToledo || relatorio.logoEmpresa) {
                    logosHTML = `
                        <h4><i class="fas fa-images"></i> Logos</h4>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            ${relatorio.logoToledo ? `
                                <div style="flex: 1; text-align: center;">
                                    <p><strong>Logo Toledo</strong></p>
                                    <img src="${relatorio.logoToledo}" style="max-width: 150px; max-height: 80px;">
                                </div>
                            ` : ''}
                            ${relatorio.logoEmpresa ? `
                                <div style="flex: 1; text-align: center;">
                                    <p><strong>Logo Empresa</strong></p>
                                    <img src="${relatorio.logoEmpresa}" style="max-width: 150px; max-height: 80px;">
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                let historicoHTML = '';
                if (relatorio.historico && relatorio.historico.length > 0) {
                    historicoHTML = `
                        <h4><i class="fas fa-history"></i> Hist√≥rico de Edi√ß√µes (${relatorio.historico.length})</h4>
                        <div style="margin-top: 10px;">
                            ${relatorio.historico.map((item, index) => `
                                <div class="historico-item">
                                    <div class="historico-data">
                                        <i class="fas fa-calendar"></i> ${item.dataFormatada}
                                    </div>
                                    <div class="historico-descricao">
                                        ${item.descricao}
                                    </div>
                                    ${item.alteracoes ? `
                                        <div class="campo-alterado">
                                            <strong>Altera√ß√µes:</strong> ${item.alteracoes}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                const tipoTexto = {
                    'manutencao': 'Manuten√ß√£o',
                    'instalacao': 'Instala√ß√£o',
                    'calibracao': 'Calibra√ß√£o',
                    'visita': 'Visita T√©cnica'
                }[relatorio.tipo] || relatorio.tipo;
                
                const detalhesHTML = `
                    <div style="padding: 20px;">
                        <h2 style="color: #2c3e50; margin-bottom: 15px;">${relatorio.empresaAtendida}</h2>
                        <h3 style="color: #3498db; margin-bottom: 20px;">${relatorio.titulo}</h3>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <p><strong><i class="fas fa-map-marker-alt"></i> Local:</strong> ${relatorio.local}</p>
                            <p><strong><i class="fas fa-calendar"></i> Data:</strong> ${relatorio.dataFormatada}</p>
                            <p><strong><i class="fas fa-tag"></i> Tipo:</strong> ${tipoTexto}</p>
                            <p><strong><i class="fas fa-hashtag"></i> O.S.:</strong> ${relatorio.numeroOS || 'N√£o informado'}</p>
                            <p><strong><i class="fas fa-hashtag"></i> N√∫mero:</strong> ${relatorio.numeroAtendimento || 'N√£o informado'}</p>
                            <p><strong><i class="fas fa-align-left"></i> Descri√ß√£o:</strong><br>${relatorio.descricao || 'Sem descri√ß√£o'}</p>
                            <p><strong><i class="fas fa-info-circle"></i> Status:</strong> ${relatorio.status}</p>
                            <p><strong><i class="fas fa-calendar-plus"></i> Criado em:</strong> ${relatorio.criadoEmFormatado}</p>
                            <p><strong><i class="fas fa-calendar-check"></i> √öltima edi√ß√£o:</strong> ${relatorio.editadoEmFormatado}</p>
                            ${relatorio.tituloOriginal && relatorio.tituloOriginal !== relatorio.titulo ? `
                                <p><strong><i class="fas fa-history"></i> T√≠tulo original:</strong> ${relatorio.tituloOriginal}</p>
                            ` : ''}
                            ${relatorio.statusOriginal && relatorio.statusOriginal !== relatorio.status ? `
                                <p><strong><i class="fas fa-history"></i> Status original:</strong> ${relatorio.statusOriginal}</p>
                            ` : ''}
                        </div>
                        
                        ${historicoHTML}
                        ${logosHTML}
                        ${fotosHTML}
                        
                        <div style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="app.editarRelatorioDireto('${relatorio.id}')" 
                                    class="btn btn-warning" style="flex: 1;">
                                <i class="fas fa-edit"></i> Editar Diretamente
                            </button>
                            <button onclick="app.editarRelatorio('${relatorio.id}')" 
                                    class="btn btn-info" style="flex: 1;">
                                <i class="fas fa-plus"></i> Adicionar Info
                            </button>
                            <button onclick="app.exportarRelatorioPDF('${relatorio.id}')" 
                                    class="btn btn-success" style="flex: 1;">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                            <button onclick="app.exportarRelatorio('${relatorio.id}')" 
                                    class="btn btn-secondary" style="flex: 1;">
                                <i class="fas fa-download"></i> Exportar JSON
                            </button>
                            <button onclick="app.excluirRelatorio('${relatorio.id}')" 
                                    class="btn btn-danger" style="flex: 1;">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                            <button onclick="this.closest('.modal').remove()" 
                                    class="btn btn-primary" style="flex: 1;">
                                <i class="fas fa-times"></i> Fechar
                            </button>
                        </div>
                    </div>
                `;
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
                        ${detalhesHTML}
                    </div>
                `;
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                document.body.appendChild(modal);
            }
            
            verFotoDetalhes(relatorioId, fotoIndex) {
                const relatorio = this.relatorios.find(r => r.id === relatorioId);
                if (!relatorio || !relatorio.fotos || !relatorio.fotos[fotoIndex]) return;
                
                const foto = relatorio.fotos[fotoIndex];
                this.modalFoto.src = foto.data;
                
                // Mostrar coment√°rio no modal
                if (foto.comentario && foto.comentario.trim() !== '') {
                    this.modalCommentText.textContent = foto.comentario;
                    document.getElementById('modalComment').style.display = 'block';
                } else {
                    this.modalCommentText.textContent = 'Nenhum coment√°rio';
                    document.getElementById('modalComment').style.display = 'block';
                }
                
                this.fotoModal.style.display = 'block';
                this.currentFotoIndex = null; // N√£o est√° editando, s√≥ visualizando
            }
            
            editarRelatorioDireto(relatorioId) {
                const relatorio = this.relatorios.find(r => r.id === relatorioId);
                if (!relatorio) return;
                
                // Salvar c√≥pia do relat√≥rio original
                this.relatorioOriginal = JSON.parse(JSON.stringify(relatorio));
                
                // Ativar modo edi√ß√£o direta
                this.modoEdicaoDireta = true;
                this.modoEdicaoDiretaInput.value = 'true';
                this.editandoRelatorioId = relatorioId;
                
                // Ocultar elementos de edi√ß√£o por adi√ß√£o
                this.informacoesOriginaisContainer.style.display = 'none';
                this.novasInformacoesContainer.style.display = 'none';
                
                // Mostrar conte√∫do original para edi√ß√£o direta
                this.conteudoOriginal.style.display = 'block';
                
                // Preencher formul√°rio com dados do relat√≥rio
                this.tituloInput.value = relatorio.titulo;
                this.localInput.value = relatorio.local;
                this.descricaoInput.value = relatorio.descricao;
                this.dataAtendimento.value = relatorio.data;
                this.empresaAtendida.value = relatorio.empresaAtendida;
                this.numeroOS.value = relatorio.numeroOS;
                this.revisao.value = relatorio.revisao;
                this.numeroAtendimento.value = relatorio.numeroAtendimento;
                
                // Selecionar tipo de atendimento
                document.querySelectorAll('input[name="tipo"]').forEach(radio => {
                    radio.checked = radio.value === relatorio.tipo;
                });
                
                // Selecionar status
                this.statusGroup.style.display = 'block';
                document.querySelectorAll('input[name="status"]').forEach(radio => {
                    radio.checked = radio.value === relatorio.status;
                });
                
                // Carregar logos
                if (relatorio.logoToledo) {
                    this.logoToledo = relatorio.logoToledo;
                    this.logoToledoPlaceholder.style.display = 'none';
                    this.logoToledoImg.src = relatorio.logoToledo;
                    this.logoToledoImg.style.display = 'block';
                    this.logoToledoButtons.style.display = 'flex';
                }
                
                if (relatorio.logoEmpresa) {
                    this.logoEmpresa = relatorio.logoEmpresa;
                    this.logoEmpresaPlaceholder.style.display = 'none';
                    this.logoEmpresaImg.src = relatorio.logoEmpresa;
                    this.logoEmpresaImg.style.display = 'block';
                    this.logoEmpresaButtons.style.display = 'flex';
                }
                
                // Carregar fotos existentes
                this.fotos = relatorio.fotos ? [...relatorio.fotos] : [];
                this.atualizarGaleria();
                this.atualizarContadorFotos();
                
                // Mostrar hist√≥rico se existir
                if (relatorio.historico && relatorio.historico.length > 0) {
                    this.historicoContainer.style.display = 'block';
                    this.carregarHistorico(relatorio);
                }
                
                // Mostrar bot√µes de edi√ß√£o direta
                this.botoesNovo.style.display = 'none';
                this.botoesEditar.style.display = 'none';
                this.botoesEdicaoDireta.style.display = 'block';
                
                // Preencher informa√ß√µes do relat√≥rio
                this.relatorioIdInput.value = relatorioId;
                this.relatorioIdTextoDireta.textContent = relatorioId.substring(0, 12) + '...';
                this.relatorioCriadoEmDireta.textContent = relatorio.criadoEmFormatado;
                this.relatorioEditadoEmDireta.textContent = relatorio.editadoEmFormatado;
                
                // Adicionar classe especial para modo edi√ß√£o direta
                document.querySelector('.app-container').classList.add('modo-edicao-direta');
                
                // Mudar para aba de novo/editar
                document.querySelector('[data-tab="novo"]').click();
                
                this.showToast('‚úèÔ∏è Editando relat√≥rio diretamente...', 'warning');
            }
            
            editarRelatorio(relatorioId) {
                const relatorio = this.relatorios.find(r => r.id === relatorioId);
                if (!relatorio) return;
                
                // Salvar c√≥pia do relat√≥rio original
                this.relatorioOriginal = JSON.parse(JSON.stringify(relatorio));
                
                // Ativar modo edi√ß√£o
                this.modoEdicao = true;
                this.editandoRelatorioId = relatorioId;
                
                // Ocultar conte√∫do original e mostrar informa√ß√µes originais
                this.conteudoOriginal.style.display = 'none';
                this.informacoesOriginaisContainer.style.display = 'block';
                this.novasInformacoesContainer.style.display = 'block';
                
                // Mostrar hist√≥rico se existir
                if (relatorio.historico && relatorio.historico.length > 0) {
                    this.historicoContainer.style.display = 'block';
                    this.carregarHistorico(relatorio);
                }
                
                // Preencher informa√ß√µes originais
                this.carregarInformacoesOriginais(relatorio);
                
                // Carregar logos
                if (relatorio.logoToledo) {
                    this.logoToledo = relatorio.logoToledo;
                    this.logoToledoPlaceholder.style.display = 'none';
                    this.logoToledoImg.src = relatorio.logoToledo;
                    this.logoToledoImg.style.display = 'block';
                    this.logoToledoButtons.style.display = 'flex';
                }
                
                if (relatorio.logoEmpresa) {
                    this.logoEmpresa = relatorio.logoEmpresa;
                    this.logoEmpresaPlaceholder.style.display = 'none';
                    this.logoEmpresaImg.src = relatorio.logoEmpresa;
                    this.logoEmpresaImg.style.display = 'block';
                    this.logoEmpresaButtons.style.display = 'flex';
                }
                
                // Carregar fotos existentes
                this.fotos = relatorio.fotos ? [...relatorio.fotos] : [];
                this.atualizarGaleria();
                this.atualizarContadorFotos();
                
                // Mostrar campo de status com valor atual
                this.statusGroup.style.display = 'block';
                document.querySelector(`input[name="novoStatus"][value="${relatorio.status}"]`).checked = true;
                
                // Mostrar bot√µes de edi√ß√£o
                this.botoesNovo.style.display = 'none';
                this.botoesEditar.style.display = 'block';
                this.botoesEdicaoDireta.style.display = 'none';
                
                // Preencher informa√ß√µes do relat√≥rio
                this.relatorioIdInput.value = relatorioId;
                this.relatorioIdTexto.textContent = relatorioId.substring(0, 12) + '...';
                this.relatorioCriadoEm.textContent = relatorio.criadoEmFormatado;
                this.relatorioEditadoEm.textContent = relatorio.editadoEmFormatado;
                
                // Limpar campos de nova informa√ß√£o
                this.novoTituloInput.value = '';
                this.novaDescricaoInput.value = '';
                
                // Mudar para aba de novo/editar
                document.querySelector('[data-tab="novo"]').click();
                
                this.showToast('üìù Adicionando informa√ß√µes ao relat√≥rio...', 'info');
            }
            
            carregarInformacoesOriginais(relatorio) {
                const tipoTexto = {
                    'manutencao': 'Manuten√ß√£o',
                    'instalacao': 'Instala√ß√£o',
                    'calibracao': 'Calibra√ß√£o',
                    'visita': 'Visita T√©cnica'
                }[relatorio.tipo] || relatorio.tipo;
                
                let html = `
                    <div style="margin-bottom: 10px;">
                        <div class="info-label-readonly">
                            <strong>T√≠tulo:</strong>
                            <span>Original</span>
                        </div>
                        <div class="form-control form-control-readonly">${relatorio.titulo}</div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <div class="info-label-readonly">
                            <strong>Local:</strong>
                            <span>Original</span>
                        </div>
                        <div class="form-control form-control-readonly">${relatorio.local}</div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <div class="info-label-readonly">
                            <strong>Tipo:</strong>
                            <span>Original</span>
                        </div>
                        <div class="form-control form-control-readonly">${tipoTexto}</div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <div class="info-label-readonly">
                            <strong>Descri√ß√£o:</strong>
                            <span>Original</span>
                        </div>
                        <div class="form-control form-control-readonly" style="min-height: 80px;">${relatorio.descricao || 'Sem descri√ß√£o'}</div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <div class="info-label-readonly">
                            <strong>Status:</strong>
                            <span>Atual</span>
                        </div>
                        <div class="form-control form-control-readonly">${relatorio.status}</div>
                    </div>
                `;
                
                this.informacoesOriginaisDiv.innerHTML = html;
            }
            
            carregarHistorico(relatorio) {
                if (!relatorio.historico || relatorio.historico.length === 0) {
                    this.historicoEdicoes.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma edi√ß√£o anterior</p>';
                    return;
                }
                
                let html = '';
                relatorio.historico.forEach((item, index) => {
                    html += `
                        <div class="historico-item">
                            <div class="historico-data">
                                <i class="fas fa-calendar"></i> ${item.dataFormatada}
                            </div>
                            <div class="historico-descricao">
                                ${item.descricao}
                            </div>
                            ${item.alteracoes ? `
                                <div class="campo-alterado">
                                    <strong>Altera√ß√µes:</strong> ${item.alteracoes}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                this.historicoEdicoes.innerHTML = html;
            }
            
            toggleInformacoesOriginais() {
                this.mostrarInformacoesOriginais = !this.mostrarInformacoesOriginais;
                const informacoes = this.informacoesOriginaisDiv.querySelectorAll('.form-control-readonly');
                
                informacoes.forEach(el => {
                    el.style.display = this.mostrarInformacoesOriginais ? 'block' : 'none';
                });
                
                const btn = document.querySelector('.toggle-btn');
                btn.innerHTML = this.mostrarInformacoesOriginais ? 
                    '<i class="fas fa-eye-slash"></i> Esconder' : 
                    '<i class="fas fa-eye"></i> Mostrar';
            }
            
            salvarEdicaoDireta() {
                if (!this.editandoRelatorioId || !this.relatorioOriginal || !this.modoEdicaoDireta) return;
                
                try {
                    // Encontrar relat√≥rio original no array
                    const relatorioIndex = this.relatorios.findIndex(r => r.id === this.editandoRelatorioId);
                    if (relatorioIndex === -1) {
                        this.showToast('‚ùå Relat√≥rio n√£o encontrado', 'error');
                        return;
                    }
                    
                    const relatorioAtual = this.relatorios[relatorioIndex];
                    
                    // Validar dados
                    if (!this.empresaAtendida.value.trim()) {
                        this.showToast('‚ùå Digite o nome da empresa atendida', 'error');
                        this.empresaAtendida.focus();
                        return;
                    }
                    
                    if (!this.tituloInput.value.trim()) {
                        this.showToast('‚ùå Digite um t√≠tulo para o relat√≥rio', 'error');
                        this.tituloInput.focus();
                        return;
                    }
                    
                    if (!this.localInput.value.trim()) {
                        this.showToast('‚ùå Informe o local do atendimento', 'error');
                        this.localInput.focus();
                        return;
                    }
                    
                    // Preparar altera√ß√µes para hist√≥rico
                    const alteracoes = [];
                    
                    // Comparar com original para ver o que mudou
                    if (this.tituloInput.value !== this.relatorioOriginal.titulo) {
                        alteracoes.push(`T√≠tulo: "${this.relatorioOriginal.titulo}" ‚Üí "${this.tituloInput.value}"`);
                    }
                    
                    if (this.localInput.value !== this.relatorioOriginal.local) {
                        alteracoes.push(`Local: "${this.relatorioOriginal.local}" ‚Üí "${this.localInput.value}"`);
                    }
                    
                    if (this.descricaoInput.value !== this.relatorioOriginal.descricao) {
                        alteracoes.push(`Descri√ß√£o modificada`);
                    }
                    
                    if (this.empresaAtendida.value !== this.relatorioOriginal.empresaAtendida) {
                        alteracoes.push(`Empresa: "${this.relatorioOriginal.empresaAtendida}" ‚Üí "${this.empresaAtendida.value}"`);
                    }
                    
                    const tipoAtual = document.querySelector('input[name="tipo"]:checked').value;
                    if (tipoAtual !== this.relatorioOriginal.tipo) {
                        const tipoOriginalTexto = {
                            'manutencao': 'Manuten√ß√£o',
                            'instalacao': 'Instala√ß√£o',
                            'calibracao': 'Calibra√ß√£o',
                            'visita': 'Visita T√©cnica'
                        }[this.relatorioOriginal.tipo] || this.relatorioOriginal.tipo;
                        
                        const tipoAtualTexto = {
                            'manutencao': 'Manuten√ß√£o',
                            'instalacao': 'Instala√ß√£o',
                            'calibracao': 'Calibra√ß√£o',
                            'visita': 'Visita T√©cnica'
                        }[tipoAtual] || tipoAtual;
                        
                        alteracoes.push(`Tipo: ${tipoOriginalTexto} ‚Üí ${tipoAtualTexto}`);
                    }
                    
                    const statusAtual = document.querySelector('input[name="status"]:checked')?.value || relatorioAtual.status;
                    if (statusAtual !== this.relatorioOriginal.status) {
                        alteracoes.push(`Status: "${this.relatorioOriginal.status}" ‚Üí "${statusAtual}"`);
                    }
                    
                    // Comparar fotos
                    const fotosOriginais = this.relatorioOriginal.fotos ? this.relatorioOriginal.fotos.length : 0;
                    const fotosAtuais = this.fotos.length;
                    if (fotosAtuais !== fotosOriginais) {
                        alteracoes.push(`Fotos: ${fotosOriginais} ‚Üí ${fotosAtuais}`);
                    }
                    
                    // Criar registro de hist√≥rico
                    const registroHistorico = {
                        data: new Date().toISOString(),
                        dataFormatada: new Date().toLocaleString('pt-BR'),
                        descricao: 'Edi√ß√£o direta do relat√≥rio',
                        alteracoes: alteracoes.length > 0 ? alteracoes.join(', ') : 'Campos modificados'
                    };
                    
                    // Criar objeto atualizado
                    const relatorioAtualizado = {
                        ...relatorioAtual,
                        titulo: this.tituloInput.value,
                        local: this.localInput.value,
                        descricao: this.descricaoInput.value,
                        tipo: document.querySelector('input[name="tipo"]:checked').value,
                        data: this.dataAtendimento.value,
                        dataFormatada: new Date(this.dataAtendimento.value).toLocaleDateString('pt-BR'),
                        empresaAtendida: this.empresaAtendida.value,
                        numeroOS: this.numeroOS.value,
                        revisao: this.revisao.value,
                        numeroAtendimento: this.numeroAtendimento.value,
                        logoToledo: this.logoToledo !== null ? this.logoToledo : relatorioAtual.logoToledo,
                        logoEmpresa: this.logoEmpresa !== null ? this.logoEmpresa : relatorioAtual.logoEmpresa,
                        fotos: [...this.fotos],
                        status: document.querySelector('input[name="status"]:checked')?.value || relatorioAtual.status,
                        editadoEm: new Date().toISOString(),
                        editadoEmFormatado: new Date().toLocaleString('pt-BR'),
                        editado: true,
                        historico: [...(relatorioAtual.historico || []), registroHistorico]
                    };
                    
                    // Preservar informa√ß√µes originais se ainda n√£o existirem
                    if (!relatorioAtualizado.tituloOriginal) {
                        relatorioAtualizado.tituloOriginal = this.relatorioOriginal.titulo;
                    }
                    
                    if (!relatorioAtualizado.statusOriginal) {
                        relatorioAtualizado.statusOriginal = this.relatorioOriginal.status;
                    }
                    
                    if (!relatorioAtualizado.descricaoOriginal) {
                        relatorioAtualizado.descricaoOriginal = this.relatorioOriginal.descricao;
                    }
                    
                    // Atualizar no array
                    this.relatorios[relatorioIndex] = relatorioAtualizado;
                    
                    // Atualizar no localStorage
                    this.atualizarNoStorage(relatorioAtualizado);
                    
                    // Sair do modo edi√ß√£o
                    this.cancelarEdicaoDireta();
                    
                    // Atualizar lista de relat√≥rios
                    this.carregarListaRelatorios();
                    
                    // Mostrar mensagem de sucesso
                    this.showToast('‚úÖ Relat√≥rio atualizado com sucesso!', 'success');
                    
                    // Perguntar se quer voltar para lista
                    setTimeout(() => {
                        if (confirm('Relat√≥rio atualizado! Deseja voltar para a lista de relat√≥rios?')) {
                            document.querySelector('[data-tab="relatorios"]').click();
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('Erro ao atualizar relat√≥rio:', error);
                    this.showToast('‚ùå Erro ao atualizar relat√≥rio', 'error');
                }
            }
            
            salvarEdicao() {
                if (!this.editandoRelatorioId || !this.relatorioOriginal) return;
                
                try {
                    // Encontrar relat√≥rio original no array
                    const relatorioIndex = this.relatorios.findIndex(r => r.id === this.editandoRelatorioId);
                    if (relatorioIndex === -1) {
                        this.showToast('‚ùå Relat√≥rio n√£o encontrado', 'error');
                        return;
                    }
                    
                    const relatorioAtual = this.relatorios[relatorioIndex];
                    
                    // Preparar altera√ß√µes
                    const alteracoes = [];
                    const novaDescricao = this.novaDescricaoInput.value.trim();
                    const novoTitulo = this.novoTituloInput.value.trim();
                    const novoStatus = document.querySelector('input[name="novoStatus"]:checked').value;
                    
                    // Verificar se houve altera√ß√µes no status
                    if (novoStatus !== relatorioAtual.status) {
                        alteracoes.push(`Status alterado de "${relatorioAtual.status}" para "${novoStatus}"`);
                    }
                    
                    // Verificar se h√° novo t√≠tulo
                    if (novoTitulo && novoTitulo !== relatorioAtual.titulo) {
                        alteracoes.push(`T√≠tulo atualizado`);
                    }
                    
                    // Verificar se h√° nova descri√ß√£o
                    if (novaDescricao) {
                        alteracoes.push(`Descri√ß√£o ampliada`);
                    }
                    
                    // Verificar se h√° novas fotos
                    const fotosOriginais = this.relatorioOriginal.fotos ? this.relatorioOriginal.fotos.length : 0;
                    const fotosAtuais = this.fotos.length;
                    if (fotosAtuais > fotosOriginais) {
                        alteracoes.push(`${fotosAtuais - fotosOriginais} nova(s) foto(s) adicionada(s)`);
                    }
                    
                    // Criar registro de hist√≥rico
                    const registroHistorico = {
                        data: new Date().toISOString(),
                        dataFormatada: new Date().toLocaleString('pt-BR'),
                        descricao: 'Novas informa√ß√µes adicionadas ao relat√≥rio',
                        alteracoes: alteracoes.length > 0 ? alteracoes.join(', ') : 'Informa√ß√µes adicionadas'
                    };
                    
                    // Criar objeto atualizado
                    const relatorioAtualizado = {
                        ...relatorioAtual,
                        // Atualizar t√≠tulo se fornecido, sen√£o manter original
                        titulo: novoTitulo || relatorioAtual.titulo,
                        // Concatenar nova descri√ß√£o √† existente
                        descricao: novaDescricao ? 
                            (relatorioAtual.descricao ? 
                                relatorioAtual.descricao + '\n\n--- NOVAS INFORMA√á√ïES ---\n' + novaDescricao : 
                                novaDescricao) : 
                            relatorioAtual.descricao,
                        // Atualizar status
                        status: novoStatus,
                        // Adicionar novas fotos √†s existentes (evitar duplicatas)
                        fotos: [...this.fotos],
                        // Atualizar logos se alterados
                        logoToledo: this.logoToledo !== null ? this.logoToledo : relatorioAtual.logoToledo,
                        logoEmpresa: this.logoEmpresa !== null ? this.logoEmpresa : relatorioAtual.logoEmpresa,
                        // Atualizar datas
                        editadoEm: new Date().toISOString(),
                        editadoEmFormatado: new Date().toLocaleString('pt-BR'),
                        editado: true,
                        // Adicionar ao hist√≥rico
                        historico: [...(relatorioAtual.historico || []), registroHistorico]
                    };
                    
                    // Preservar informa√ß√µes originais se ainda n√£o existirem
                    if (!relatorioAtualizado.tituloOriginal) {
                        relatorioAtualizado.tituloOriginal = this.relatorioOriginal.titulo;
                    }
                    
                    if (!relatorioAtualizado.statusOriginal) {
                        relatorioAtualizado.statusOriginal = this.relatorioOriginal.status;
                    }
                    
                    if (!relatorioAtualizado.descricaoOriginal) {
                        relatorioAtualizado.descricaoOriginal = this.relatorioOriginal.descricao;
                    }
                    
                    // Atualizar no array
                    this.relatorios[relatorioIndex] = relatorioAtualizado;
                    
                    // Atualizar no localStorage
                    this.atualizarNoStorage(relatorioAtualizado);
                    
                    // Limpar formul√°rio e sair do modo edi√ß√£o
                    this.cancelarEdicao();
                    
                    // Atualizar lista de relat√≥rios
                    this.carregarListaRelatorios();
                    
                    // Mostrar mensagem de sucesso
                    this.showToast('‚úÖ Novas informa√ß√µes adicionadas com sucesso!', 'success');
                    
                    // Perguntar se quer voltar para lista
                    setTimeout(() => {
                        if (confirm('Informa√ß√µes adicionadas! Deseja voltar para a lista de relat√≥rios?')) {
                            document.querySelector('[data-tab="relatorios"]').click();
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('Erro ao atualizar relat√≥rio:', error);
                    this.showToast('‚ùå Erro ao atualizar relat√≥rio', 'error');
                }
            }
            
            cancelarEdicao() {
                // Limpar formul√°rio
                this.limparFormulario();
                
                // Sair do modo edi√ß√£o
                this.modoEdicao = false;
                this.editandoRelatorioId = null;
                this.relatorioOriginal = null;
                
                // Ocultar elementos de edi√ß√£o
                this.informacoesOriginaisContainer.style.display = 'none';
                this.novasInformacoesContainer.style.display = 'none';
                this.conteudoOriginal.style.display = 'block';
                this.historicoContainer.style.display = 'none';
                this.statusGroup.style.display = 'none';
                
                // Mostrar bot√µes de novo
                this.botoesNovo.style.display = 'block';
                this.botoesEditar.style.display = 'none';
                this.botoesEdicaoDireta.style.display = 'none';
                
                // Limpar campo ID
                this.relatorioIdInput.value = '';
                
                this.showToast('‚úèÔ∏è Edi√ß√£o cancelada', 'info');
            }
            
            cancelarEdicaoDireta() {
                // Limpar formul√°rio
                this.limparFormulario();
                
                // Sair do modo edi√ß√£o
                this.modoEdicao = false;
                this.modoEdicaoDireta = false;
                this.modoEdicaoDiretaInput.value = 'false';
                this.editandoRelatorioId = null;
                this.relatorioOriginal = null;
                
                // Remover classe especial
                document.querySelector('.app-container').classList.remove('modo-edicao-direta');
                
                // Ocultar elementos de edi√ß√£o
                this.informacoesOriginaisContainer.style.display = 'none';
                this.novasInformacoesContainer.style.display = 'none';
                this.conteudoOriginal.style.display = 'block';
                this.historicoContainer.style.display = 'none';
                this.statusGroup.style.display = 'none';
                
                // Mostrar bot√µes de novo
                this.botoesNovo.style.display = 'block';
                this.botoesEditar.style.display = 'none';
                this.botoesEdicaoDireta.style.display = 'none';
                
                // Limpar campo ID
                this.relatorioIdInput.value = '';
                
                this.showToast('‚úèÔ∏è Edi√ß√£o direta cancelada', 'info');
            }
            
            duplicarRelatorio() {
                if (!this.editandoRelatorioId) return;
                
                if (confirm('Deseja criar uma c√≥pia deste relat√≥rio? Ser√° criado um novo relat√≥rio com os mesmos dados.')) {
                    // Encontrar relat√≥rio original
                    const relatorioOriginal = this.relatorios.find(r => r.id === this.editandoRelatorioId);
                    if (!relatorioOriginal) return;
                    
                    // Criar c√≥pia com novo ID
                    const relatorioCopia = {
                        ...relatorioOriginal,
                        id: 'rel_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        criadoEm: new Date().toISOString(),
                        criadoEmFormatado: new Date().toLocaleString('pt-BR'),
                        editadoEm: new Date().toISOString(),
                        editadoEmFormatado: new Date().toLocaleString('pt-BR'),
                        editado: false,
                        status: 'pendente',
                        historico: [],
                        tituloOriginal: relatorioOriginal.titulo,
                        statusOriginal: 'pendente',
                        descricaoOriginal: relatorioOriginal.descricao
                    };
                    
                    // Adicionar √† lista
                    this.relatorios.unshift(relatorioCopia);
                    
                    // Salvar no localStorage
                    this.salvarNoStorage(relatorioCopia);
                    
                    // Limpar formul√°rio
                    this.cancelarEdicao();
                    
                    // Atualizar lista
                    this.carregarListaRelatorios();
                    
                    this.showToast('üìã Relat√≥rio duplicado com sucesso!', 'success');
                    
                    // Perguntar se quer editar a c√≥pia
                    setTimeout(() => {
                        if (confirm('C√≥pia criada! Deseja editar o novo relat√≥rio?')) {
                            this.editarRelatorioDireto(relatorioCopia.id);
                        }
                    }, 500);
                }
            }
            
            async gerarPDFDireto() {
                if (this.modoEdicao && this.editandoRelatorioId) {
                    // Se est√° editando, gerar PDF do relat√≥rio sendo editado
                    const relatorio = this.relatorios.find(r => r.id === this.editandoRelatorioId);
                    if (relatorio) {
                        // Criar vers√£o atualizada tempor√°ria
                        const relatorioTemp = {
                            ...relatorio,
                            fotos: [...this.fotos],
                            logoToledo: this.logoToledo !== null ? this.logoToledo : relatorio.logoToledo,
                            logoEmpresa: this.logoEmpresa !== null ? this.logoEmpresa : relatorio.logoEmpresa
                        };
                        
                        // Adicionar nova descri√ß√£o se houver
                        const novaDescricao = this.novaDescricaoInput.value.trim();
                        if (novaDescricao) {
                            relatorioTemp.descricao = relatorioTemp.descricao ? 
                                relatorioTemp.descricao + '\n\n--- NOVAS INFORMA√á√ïES ---\n' + novaDescricao : 
                                novaDescricao;
                        }
                        
                        // Atualizar t√≠tulo se houver
                        const novoTitulo = this.novoTituloInput.value.trim();
                        if (novoTitulo) {
                            relatorioTemp.titulo = novoTitulo;
                        }
                        
                        await this.gerarPDF(relatorioTemp);
                        return;
                    }
                }
                
                // Se est√° em modo edi√ß√£o direta
                if (this.modoEdicaoDireta && this.editandoRelatorioId) {
                    const relatorio = this.relatorios.find(r => r.id === this.editandoRelatorioId);
                    if (relatorio) {
                        // Criar vers√£o atualizada tempor√°ria
                        const relatorioTemp = {
                            ...relatorio,
                            titulo: this.tituloInput.value,
                            local: this.localInput.value,
                            descricao: this.descricaoInput.value,
                            tipo: document.querySelector('input[name="tipo"]:checked').value,
                            data: this.dataAtendimento.value,
                            dataFormatada: new Date(this.dataAtendimento.value).toLocaleDateString('pt-BR'),
                            empresaAtendida: this.empresaAtendida.value,
                            numeroOS: this.numeroOS.value,
                            revisao: this.revisao.value,
                            numeroAtendimento: this.numeroAtendimento.value,
                            fotos: [...this.fotos],
                            logoToledo: this.logoToledo,
                            logoEmpresa: this.logoEmpresa,
                            status: document.querySelector('input[name="status"]:checked')?.value || relatorio.status
                        };
                        
                        await this.gerarPDF(relatorioTemp);
                        return;
                    }
                }
                
                // Caso normal (n√£o est√° editando)
                if (this.fotos.length === 0 && !this.tituloInput.value.trim()) {
                    this.showToast('‚ùå Adicione dados ou fotos primeiro', 'error');
                    return;
                }
                
                try {
                    const relatorioTemp = {
                        titulo: this.tituloInput.value || 'Relat√≥rio Sem T√≠tulo',
                        local: this.localInput.value || 'Local n√£o informado',
                        descricao: this.descricaoInput.value || 'Sem descri√ß√£o',
                        tipo: document.querySelector('input[name="tipo"]:checked').value,
                        data: this.dataAtendimento.value,
                        dataFormatada: new Date(this.dataAtendimento.value).toLocaleDateString('pt-BR'),
                        empresaAtendida: this.empresaAtendida.value,
                        numeroOS: this.numeroOS.value,
                        revisao: this.revisao.value,
                        numeroAtendimento: this.numeroAtendimento.value,
                        logoToledo: this.logoToledo,
                        logoEmpresa: this.logoEmpresa,
                        fotos: [...this.fotos]
                    };
                    
                    await this.gerarPDF(relatorioTemp);
                    
                } catch (error) {
                    console.error('Erro ao gerar PDF:', error);
                    this.showToast('‚ùå Erro ao gerar PDF', 'error');
                }
            }
            
            async exportarRelatorioPDF(relatorioId) {
                const relatorio = this.relatorios.find(r => r.id === relatorioId);
                if (!relatorio) return;
                
                await this.gerarPDF(relatorio);
            }
            
            async gerarPDF(relatorio) {
                try {
                    this.showToast('üîÑ Gerando PDF...', 'info');
                    
                    if (!window.jspdf && !window.jsPDF) {
                        throw new Error('Biblioteca PDF n√£o carregada');
                    }
                    
                    const { jsPDF } = window.jspdf || { jsPDF: window.jsPDF };
                    const doc = new jsPDF();
                    
                    const pageWidth = doc.internal.pageSize.getWidth();
                    const margin = 20;
                    let yPosition = margin;
                    
                    // CABE√áALHO DO RELAT√ìRIO TOLEDO
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.text("RELAT√ìRIO DE ATENDIMENTO", pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 10;
                    
                    // Linha divis√≥ria
                    doc.setLineWidth(0.5);
                    doc.line(margin, yPosition, pageWidth - margin, yPosition);
                    yPosition += 15;
                    
                    // Informa√ß√µes em duas colunas
                    const col1 = margin;
                    const col2 = pageWidth / 2 + 10;
                    
                    // Coluna 1: Logo Toledo
                    if (relatorio.logoToledo) {
                        try {
                            doc.addImage(relatorio.logoToledo, 'JPEG', col1, yPosition, 60, 30);
                        } catch (e) {
                            doc.setFontSize(12);
                            doc.text("Toledo do Brasil SI", col1, yPosition + 15);
                        }
                    } else {
                        doc.setFontSize(12);
                        doc.setFont('helvetica', 'bold');
                        doc.text("Toledo do Brasil SI", col1, yPosition + 15);
                    }
                    
                    // Coluna 2: Logo Empresa
                    if (relatorio.logoEmpresa) {
                        try {
                            doc.addImage(relatorio.logoEmpresa, 'JPEG', pageWidth - margin - 60, yPosition, 60, 30);
                        } catch (e) {
                            // Se der erro ao carregar imagem, mostra texto
                        }
                    }
                    
                    yPosition += 35;
                    
                    // Informa√ß√µes centrais
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`DATA: ${relatorio.dataFormatada}`, pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 8;
                    
                    doc.setFont('helvetica', 'bold');
                    doc.text(relatorio.empresaAtendida.toUpperCase(), pageWidth / 2, yPosition, { align: 'center' });
                    yPosition += 10;
                    
                    // Informa√ß√µes em linha
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`N√öMERO DA O.S.: ${relatorio.numeroOS || "N/A"}`, margin, yPosition);
                    doc.text(`REVIS√ÉO: ${relatorio.revisao || "00"}`, pageWidth - margin - 40, yPosition);
                    yPosition += 8;
                    
                    doc.text(`N√öMERO: ${relatorio.numeroAtendimento || "N/A"}`, margin, yPosition);
                    yPosition += 15;
                    
                    // T√≠tulo do relat√≥rio
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.text(relatorio.titulo, margin, yPosition);
                    yPosition += 10;
                    
                    // Informa√ß√µes do atendimento
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    
                    const tipoTexto = {
                        'manutencao': 'Manuten√ß√£o',
                        'instalacao': 'Instala√ß√£o',
                        'calibracao': 'Calibra√ß√£o',
                        'visita': 'Visita T√©cnica'
                    }[relatorio.tipo] || relatorio.tipo;
                    
                    doc.text(`Local: ${relatorio.local}`, margin, yPosition);
                    yPosition += 8;
                    
                    doc.text(`Tipo de Atendimento: ${tipoTexto}`, margin, yPosition);
                    yPosition += 8;
                    
                    // Descri√ß√£o
                    if (relatorio.descricao) {
                        yPosition += 10;
                        doc.setFont('helvetica', 'bold');
                        doc.text('Descri√ß√£o do Atendimento:', margin, yPosition);
                        yPosition += 8;
                        
                        doc.setFont('helvetica', 'normal');
                        const descLines = doc.splitTextToSize(relatorio.descricao, pageWidth - 2 * margin);
                        doc.text(descLines, margin, yPosition);
                        yPosition += descLines.length * 6;
                    }
                    
                    // Fotos
                    if (relatorio.fotos && relatorio.fotos.length > 0) {
                        yPosition += 15;
                        doc.setFont('helvetica', 'bold');
                        doc.text(`Fotos do Atendimento (${relatorio.fotos.length}):`, margin, yPosition);
                        yPosition += 10;
                        
                        const fotoWidth = 80;
                        const fotoHeight = 60;
                        const fotosPerRow = 2;
                        let fotoIndex = 0;
                        
                        // Primeiro, adicionar todas as imagens
                        for (let i = 0; i < relatorio.fotos.length; i++) {
                            const foto = relatorio.fotos[i];
                            
                            // Nova p√°gina se necess√°rio
                            if (yPosition + fotoHeight > doc.internal.pageSize.getHeight() - margin - 30) {
                                doc.addPage();
                                yPosition = margin;
                            }
                            
                            const col = fotoIndex % fotosPerRow;
                            const row = Math.floor(fotoIndex / fotosPerRow);
                            
                            const xPos = margin + col * (fotoWidth + 10);
                            const yPos = yPosition + row * (fotoHeight + 20);
                            
                            try {
                                doc.addImage(foto.data, 'JPEG', xPos, yPos, fotoWidth, fotoHeight);
                                doc.setFontSize(8);
                                doc.text(`Foto ${i + 1}`, xPos + fotoWidth/2, yPos + fotoHeight + 5, { align: 'center' });
                                
                                // Adicionar coment√°rio se existir
                                if (foto.comentario && foto.comentario.trim() !== '') {
                                    doc.setFontSize(7);
                                    const commentLines = doc.splitTextToSize(foto.comentario, fotoWidth);
                                    doc.text(commentLines, xPos, yPos + fotoHeight + 15, { maxWidth: fotoWidth });
                                    yPosition += commentLines.length * 3;
                                }
                                
                                fotoIndex++;
                                
                                if (col === fotosPerRow - 1) {
                                    yPosition += fotoHeight + 25;
                                }
                                
                            } catch (imgError) {
                                console.warn('Erro ao adicionar imagem:', imgError);
                                doc.text(`[Erro ao carregar foto ${i + 1}]`, xPos, yPos);
                            }
                        }
                        
                        yPosition += (Math.ceil(fotoIndex / fotosPerRow) - 1) * (fotoHeight + 25) + fotoHeight + 30;
                    }
                    
                    // Rodap√©
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'italic');
                    doc.text(
                        `Relat√≥rio gerado em ${new Date().toLocaleString('pt-BR')} - Sistema Toledo do Brasil`,
                        pageWidth / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                    
                    // Salvar
                    const fileName = `Relatorio_${relatorio.empresaAtendida.replace(/[^a-z0-9]/gi, '_')}_${relatorio.dataFormatada.replace(/\//g, '-')}.pdf`;
                    doc.save(fileName);
                    
                    this.showToast('‚úÖ PDF gerado com sucesso!', 'success');
                    
                } catch (error) {
                    console.error('Erro ao gerar PDF:', error);
                    this.gerarHTMLParaImpressao(relatorio);
                }
            }
            
            gerarHTMLParaImpressao(relatorio) {
                let fotosHTML = '';
                if (relatorio.fotos && relatorio.fotos.length > 0) {
                    fotosHTML = `
                        <h3>Fotos do Atendimento (${relatorio.fotos.length})</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            ${relatorio.fotos.map((foto, i) => `
                                <div style="border: 1px solid #ddd; border-radius: 8px; padding: 10px;">
                                    <img src="${foto.data}" style="width: 100%; height: 150px; object-fit: cover;">
                                    <p style="text-align: center; font-size: 12px; font-weight: bold;">Foto ${i + 1}</p>
                                    ${foto.comentario && foto.comentario.trim() !== '' ? `
                                        <p style="font-size: 11px; color: #666; margin-top: 5px;">
                                            <strong>Coment√°rio:</strong> ${foto.comentario}
                                        </p>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                let logosHTML = '';
                if (relatorio.logoToledo || relatorio.logoEmpresa) {
                    logosHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            ${relatorio.logoToledo ? `
                                <div style="flex: 1; text-align: center;">
                                    <img src="${relatorio.logoToledo}" style="max-width: 150px; max-height: 80px;">
                                    <p style="font-size: 12px;">Toledo do Brasil SI</p>
                                </div>
                            ` : '<div style="flex: 1;"></div>'}
                            ${relatorio.logoEmpresa ? `
                                <div style="flex: 1; text-align: center;">
                                    <img src="${relatorio.logoEmpresa}" style="max-width: 150px; max-height: 80px;">
                                    <p style="font-size: 12px;">${relatorio.empresaAtendida}</p>
                                </div>
                            ` : '<div style="flex: 1;"></div>'}
                        </div>
                    `;
                }
                
                const tipoTexto = {
                    'manutencao': 'Manuten√ß√£o',
                    'instalacao': 'Instala√ß√£o',
                    'calibracao': 'Calibra√ß√£o',
                    'visita': 'Visita T√©cnica'
                }[relatorio.tipo] || relatorio.tipo;
                
                const html = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${relatorio.empresaAtendida} - Relat√≥rio de Atendimento</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #2c3e50; text-align: center; }
                            h2 { color: #3498db; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .info { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0; }
                            .info-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
                            .info-label { font-weight: bold; min-width: 150px; }
                            @media print {
                                body { padding: 10px; }
                                button { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>RELAT√ìRIO DE ATENDIMENTO</h1>
                            <p><strong>DATA:</strong> ${relatorio.dataFormatada}</p>
                        </div>
                        
                        ${logosHTML}
                        
                        <div class="info-row">
                            <div><strong>N√öMERO DA O.S.:</strong> ${relatorio.numeroOS || 'N/A'}</div>
                            <div><strong>REVIS√ÉO:</strong> ${relatorio.revisao || '00'}</div>
                            <div><strong>N√öMERO:</strong> ${relatorio.numeroAtendimento || 'N/A'}</div>
                        </div>
                        
                        <h2>${relatorio.empresaAtendida}</h2>
                        <h3>${relatorio.titulo}</h3>
                        
                        <div class="info">
                            <p><strong>Local:</strong> ${relatorio.local}</p>
                            <p><strong>Tipo de Atendimento:</strong> ${tipoTexto}</p>
                            <p><strong>Descri√ß√£o:</strong><br>${relatorio.descricao || 'Sem descri√ß√£o'}</p>
                        </div>
                        
                        ${fotosHTML}
                        
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                            <p style="text-align: center; font-size: 12px; color: #666;">
                                Relat√≥rio gerado em ${new Date().toLocaleString('pt-BR')}<br>
                                Sistema Toledo do Brasil - Relat√≥rios Offline
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                Imprimir Relat√≥rio
                            </button>
                        </div>
                        
                        <script>
                            window.onload = function() {
                                // Opcional: imprimir automaticamente
                                // setTimeout(() => window.print(), 1000);
                            }
                        <\/script>
                    </body>
                    </html>
                `;
                
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const printWindow = window.open(url, '_blank');
                
                // Focar na nova janela para impress√£o
                if (printWindow) {
                    printWindow.focus();
                }
            }
            
            exportarRelatorio(relatorioId) {
                const relatorio = this.relatorios.find(r => r.id === relatorioId);
                if (!relatorio) return;
                
                const dataStr = JSON.stringify(relatorio, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const fileName = `Relatorio_${relatorio.empresaAtendida.replace(/[^a-z0-9]/gi, '_')}_${relatorio.id}.json`;
                
                const link = document.createElement('a');
                link.href = dataUri;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showToast('üì§ Relat√≥rio exportado!', 'success');
            }
            
            excluirRelatorio(relatorioId) {
                if (confirm('Tem certeza que deseja excluir este relat√≥rio?')) {
                    this.relatorios = this.relatorios.filter(r => r.id !== relatorioId);
                    
                    let relatoriosStorage = JSON.parse(localStorage.getItem('relatorios_toledo') || '[]');
                    relatoriosStorage = relatoriosStorage.filter(r => r.id !== relatorioId);
                    localStorage.setItem('relatorios_toledo', JSON.stringify(relatoriosStorage));
                    
                    this.carregarListaRelatorios();
                    this.showToast('üóëÔ∏è Relat√≥rio exclu√≠do', 'info');
                }
            }
            
            carregarTodasFotos() {
                const todasFotos = [];
                
                this.relatorios.forEach(relatorio => {
                    if (relatorio.fotos && relatorio.fotos.length > 0) {
                        relatorio.fotos.forEach(foto => {
                            todasFotos.push({
                                ...foto,
                                relatorioTitulo: relatorio.titulo,
                                relatorioEmpresa: relatorio.empresaAtendida,
                                relatorioId: relatorio.id
                            });
                        });
                    }
                });
                
                if (todasFotos.length === 0) {
                    this.todasFotos.innerHTML = `
                        <div class="no-items">
                            <i class="fas fa-images"></i>
                            <p>Nenhuma foto salva</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                todasFotos.forEach((foto, index) => {
                    const temComentario = foto.comentario && foto.comentario.trim() !== '';
                    
                    html += `
                        <div class="foto-item" onclick="app.verFotoRelatorio('${foto.relatorioId}', ${index})">
                            <img src="${foto.data}" alt="Foto do relat√≥rio">
                            ${temComentario ? `
                                <div class="foto-comment-badge">
                                    <i class="fas fa-comment"></i>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                this.todasFotos.innerHTML = html;
            }
            
            limparFormulario(manterLogos = false) {
                this.tituloInput.value = '';
                this.localInput.value = '';
                this.descricaoInput.value = '';
                this.empresaAtendida.value = '';
                this.numeroOS.value = '';
                this.numeroAtendimento.value = '';
                document.querySelector('input[name="tipo"][value="manutencao"]').checked = true;
                
                // Limpar campos de nova informa√ß√£o
                this.novoTituloInput.value = '';
                this.novaDescricaoInput.value = '';
                
                this.fotos = [];
                this.atualizarGaleria();
                this.atualizarContadorFotos();
                
                if (!manterLogos) {
                    this.removerLogoToledo();
                    this.removerLogoEmpresa();
                }
                
                this.setDataAtual();
                
                this.showToast('üìù Formul√°rio limpo', 'info');
            }
            
            limparTudo() {
                if (confirm('‚ö†Ô∏è ATEN√á√ÉO! Isso ir√° apagar TODOS os relat√≥rios, fotos e logos. Tem certeza?')) {
                    localStorage.removeItem('relatorios_toledo');
                    
                    this.relatorios = [];
                    this.fotos = [];
                    this.logoToledo = null;
                    this.logoEmpresa = null;
                    
                    this.removerLogoToledo();
                    this.removerLogoEmpresa();
                    this.carregarListaRelatorios();
                    this.atualizarGaleria();
                    this.atualizarContadorFotos();
                    
                    this.showToast('üßπ Todos os dados foram apagados', 'info');
                }
            }
            
            exportarDados() {
                const todosDados = {
                    relatorios: this.relatorios,
                    exportadoEm: new Date().toISOString(),
                    totalRelatorios: this.relatorios.length,
                    totalFotos: this.relatorios.reduce((total, r) => total + (r.fotos ? r.fotos.length : 0), 0),
                    sistema: "Toledo Relat√≥rios de Atendimento"
                };
                
                const dataStr = JSON.stringify(todosDados, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const link = document.createElement('a');
                link.href = dataUri;
                link.download = `backup_toledo_${new Date().getTime()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showToast('üíæ Backup exportado com sucesso!', 'success');
            }
            
            importarDados(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const dados = JSON.parse(e.target.result);
                        
                        if (!dados.relatorios || !Array.isArray(dados.relatorios)) {
                            throw new Error('Formato de arquivo inv√°lido');
                        }
                        
                        const relatoriosAtuais = JSON.parse(localStorage.getItem('relatorios_toledo') || '[]');
                        const novosRelatorios = [...dados.relatorios, ...relatoriosAtuais];
                        
                        const relatoriosUnicos = [];
                        const idsVistos = new Set();
                        
                        for (const relatorio of novosRelatorios) {
                            if (!idsVistos.has(relatorio.id)) {
                                idsVistos.add(relatorio.id);
                                relatoriosUnicos.push(relatorio);
                            }
                        }
                        
                        localStorage.setItem('relatorios_toledo', JSON.stringify(relatoriosUnicos));
                        
                        this.relatorios = relatoriosUnicos;
                        this.carregarListaRelatorios();
                        
                        this.showToast(`‚úÖ ${dados.relatorios.length} relat√≥rios importados!`, 'success');
                        
                    } catch (error) {
                        console.error('Erro ao importar:', error);
                        this.showToast('‚ùå Erro ao importar arquivo', 'error');
                    }
                    
                    event.target.value = '';
                };
                
                reader.readAsText(file);
            }
            
            showToast(message, type = 'info') {
                this.toast.textContent = message;
                this.toast.style.display = 'block';
                
                if (type === 'success') {
                    this.toast.style.background = '#27ae60';
                } else if (type === 'error') {
                    this.toast.style.background = '#e74c3c';
                } else if (type === 'info') {
                    this.toast.style.background = '#3498db';
                } else if (type === 'warning') {
                    this.toast.style.background = '#f39c12';
                }
                
                setTimeout(() => {
                    this.toast.style.display = 'none';
                }, 3000);
            }
        }
        
        // Inicializar app quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new RelatorioToledoApp();
            
            // Fun√ß√£o global para acesso no HTML
            window.verFotoRelatorio = function(relatorioId, fotoIndex) {
                const relatorio = app.relatorios.find(r => r.id === relatorioId);
                if (relatorio && relatorio.fotos && relatorio.fotos[fotoIndex]) {
                    const foto = relatorio.fotos[fotoIndex];
                    app.modalFoto.src = foto.data;
                    
                    // Mostrar coment√°rio no modal
                    if (foto.comentario && foto.comentario.trim() !== '') {
                        app.modalCommentText.textContent = foto.comentario;
                        document.getElementById('modalComment').style.display = 'block';
                    } else {
                        app.modalCommentText.textContent = 'Nenhum coment√°rio';
                        document.getElementById('modalComment').style.display = 'block';
                    }
                    
                    app.fotoModal.style.display = 'block';
                    app.currentFotoIndex = null; // N√£o est√° editando, s√≥ visualizando
                }
            };
        });
    </script>
</body>
</html>